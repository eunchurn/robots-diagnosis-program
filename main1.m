function varargout = main1(varargin)
% MAIN1 M-file for main1.fig
%      MAIN1, by itself, creates a new MAIN1 or raises the existing
%      singleton*.
%
%      H = MAIN1 returns the handle to a new MAIN1 or the handle to
%      the existing singleton*.
%
%      MAIN1('CALLBACK',hObject,eventData,handles,...) calls the local
%      function named CALLBACK in MAIN1.M with the given input arguments.
%
%      MAIN1('Property','Value',...) creates a new MAIN1 or raises the
%      existing singleton*.  Starting from the left, property value pairs are
%      applied to the GUI before main1_OpeningFcn gets called.  An
%      unrecognized property name or invalid value makes property application
%      stop.  All inputs are passed to main1_OpeningFcn via varargin.
%
%      *See GUI Options on GUIDE's Tools menu.  Choose "GUI allows only one
%      instance to run (singleton)".
%
% See also: GUIDE, GUIDATA, GUIHANDLES

% Edit the above text to modify the response to help main1

% Last Modified by GUIDE v2.5 29-Jan-2013 08:07:05

% Begin initialization code - DO NOT EDIT
gui_Singleton = 1;
gui_State = struct('gui_Name',       mfilename, ...
    'gui_Singleton',  gui_Singleton, ...
    'gui_OpeningFcn', @main1_OpeningFcn, ...
    'gui_OutputFcn',  @main1_OutputFcn, ...
    'gui_LayoutFcn',  [] , ...
    'gui_Callback',   []);
if nargin && ischar(varargin{1})
    gui_State.gui_Callback = str2func(varargin{1});
end

if nargout
    [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
else
    gui_mainfcn(gui_State, varargin{:});
end
% End initialization code - DO NOT EDIT


% --- Executes just before main1 is made visible.
function main1_OpeningFcn(hObject, eventdata, handles, varargin)
% This function has no output args, see OutputFcn.
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
% varargin   command line arguments to main1 (see VARARGIN)

% Choose default command line output for main1
handles.output = hObject;

% Update handles structure
guidata(hObject, handles);

% UIWAIT makes main1 wait for user response (see UIRESUME)
% uiwait(handles.figure1);


% --- Outputs from this function are returned to the command line.
function varargout = main1_OutputFcn(hObject, eventdata, handles)
% varargout  cell array for returning output args (see VARARGOUT);
% hObject    handle to figure
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Get default command line output from handles structure
varargout{1} = handles.output;

warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
jframe=get(handles.figure1,'javaframe');
jIcon=javax.swing.ImageIcon('logoonly.png');
jframe.setFigureIcon(jIcon);

[logocd,logomap,logoalpha]=imread('kmlogo.png','BackgroundColor','none');
set(handles.logobottom,'CData',logocd);
set(handles.logobottom,'Visible','off');
% logo=imread('footlogo.png','png');
% bg = [0.925 0.914 0.847];
% logo = imread('footlogo.png','BackgroundColor',bg);
% logo(:,:,1)=[236,236,236,236,236,236,236,236,233,218,209,199,196,196,196,196,201,211,226,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,236,236,236,236,236,233,216,199,196,196,196,196,196,196,196,196,196,196,201,226,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,236,236,236,236,228,201,196,196,203,229,240,255,255,226,196,196,196,196,196,196,211,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,236,236,236,228,199,196,200,233,255,248,229,218,211,203,196,196,196,196,196,196,196,204,233,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,236,236,228,199,196,207,251,248,218,196,196,196,196,196,196,196,196,196,196,196,196,196,209,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,214,207,207,207,214,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,236,236,204,196,207,251,237,200,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,216,236,236,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,236,236,236,177,134,119,119,119,119,119,126,177,229,236,236,236,236,236,236,236,236,192,148,148,148,148,148,148,148,170,207,236,236,236,236,236,170,148,148,148,214,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,214,148,148,148,170,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,236,216,196,200,251,237,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,199,231,236,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,236,229,141,119,119,119,119,119,119,119,119,119,141,229,236,236,236,236,236,236,236,177,119,119,119,119,119,119,119,119,119,148,221,236,236,236,148,119,119,119,207,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,233,199,196,233,248,200,196,218,240,233,196,196,229,218,196,196,196,196,196,196,196,196,196,196,211,236,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,236,148,119,119,119,119,119,119,119,119,119,119,119,148,236,236,236,236,236,236,236,177,119,119,119,119,119,119,119,119,119,119,126,229,236,236,148,119,119,119,207,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,221,196,203,255,218,196,196,251,255,255,211,196,240,226,196,196,196,196,196,196,196,196,196,196,199,236,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,192,119,119,119,119,141,199,236,199,126,119,119,119,119,214,236,236,236,236,236,236,177,119,119,119,134,148,148,134,119,119,119,119,156,236,236,192,177,177,177,221,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236;236,209,196,229,248,196,196,196,248,255,255,207,196,240,226,196,196,196,196,196,196,196,196,196,196,196,223,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,141,119,119,119,119,221,236,236,236,199,119,119,119,119,185,236,236,236,236,236,236,177,119,119,119,177,236,236,236,185,119,119,119,119,221,236,192,177,177,177,221,236,236,221,163,148,119,119,148,163,221,236,236,236,207,207,207,214,229,192,177,177,207,236,236,236,207,119,119,119,148,236,236,236,229,192,163,148,148,163,192,229,236,229,207,207,207,214,236,236,236,236,221,207,207;236,199,196,240,229,196,196,196,203,226,214,196,196,240,226,196,196,196,196,196,196,196,196,196,196,196,216,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,119,119,119,119,163,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,177,119,119,119,177,236,236,236,236,163,119,119,119,185,236,148,119,119,119,207,236,192,119,119,119,119,119,119,119,119,192,236,236,119,119,119,141,141,119,119,119,119,148,229,236,207,119,119,119,148,236,236,192,126,119,119,119,119,119,119,126,214,236,134,119,119,126,236,236,236,236,163,119,119;236,196,196,255,214,196,196,196,196,196,196,196,196,240,226,196,196,196,196,196,196,196,196,196,196,196,209,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,207,119,119,119,119,192,236,236,221,207,207,207,207,207,207,221,236,236,236,236,236,236,177,119,119,119,177,236,236,236,236,207,119,119,119,163,236,148,119,119,119,207,236,126,119,119,119,170,163,119,119,119,119,229,236,119,119,119,119,119,119,119,119,119,119,170,236,207,119,119,119,148,236,229,126,119,119,119,148,141,119,119,119,126,236,170,119,119,119,214,236,236,236,126,119,119;236,196,196,255,211,196,196,196,196,196,196,196,196,240,226,196,203,226,226,226,226,226,226,226,218,196,206,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,207,119,119,119,119,207,236,236,177,119,119,119,119,119,119,177,236,236,236,236,236,236,177,119,119,119,177,236,236,236,236,221,119,119,119,148,236,148,119,119,119,207,214,119,119,119,148,236,236,177,148,148,148,214,236,119,119,119,119,141,199,192,126,119,119,119,229,207,119,119,119,148,236,207,119,119,119,148,236,236,148,119,119,119,207,214,119,119,119,170,236,236,214,119,119,119;236,196,196,255,211,196,196,196,196,196,196,196,196,240,226,196,207,240,240,240,240,240,240,251,237,196,206,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,207,119,119,119,119,207,236,236,177,119,119,119,119,119,119,177,236,236,236,236,236,236,177,119,119,119,177,236,236,236,236,221,119,119,119,148,236,148,119,119,119,207,236,119,119,119,119,163,199,229,236,236,236,236,236,119,119,119,119,207,236,236,170,119,119,119,207,207,119,119,119,148,236,236,236,236,236,236,236,236,177,119,119,119,177,236,141,119,119,141,236,236,185,119,119,119;236,196,196,255,214,196,196,196,196,196,196,196,196,240,226,196,196,196,196,196,196,196,196,240,226,196,209,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,207,119,119,119,119,192,236,236,192,148,148,134,119,119,119,177,236,236,236,236,236,236,177,119,119,119,177,236,236,236,236,199,119,119,119,156,236,148,119,119,119,207,236,170,119,119,119,119,119,119,148,192,236,236,236,119,119,119,119,236,236,236,207,119,119,119,177,207,119,119,119,148,236,236,236,199,163,148,126,119,119,119,119,119,177,236,185,119,119,119,221,236,156,119,119,156;236,199,196,240,229,196,196,196,196,196,196,196,196,240,226,196,196,196,196,196,196,196,196,251,218,196,216,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,119,119,119,119,163,236,236,236,236,236,177,119,119,119,177,236,236,236,236,236,236,177,119,119,119,177,236,236,236,236,163,119,119,119,177,236,148,119,119,119,207,236,236,192,134,119,119,119,119,119,119,141,229,236,119,119,119,119,236,236,236,207,119,119,119,177,207,119,119,119,148,236,214,141,119,119,119,119,119,119,119,119,119,177,236,229,119,119,119,185,236,126,119,119,192;236,209,196,229,248,196,196,196,196,196,196,196,196,240,226,196,196,196,196,196,196,196,214,255,203,196,223,236,236,236,236,236,236,119,119,119,119,207,236,236,236,236,236,236,236,141,119,119,119,126,229,236,236,236,236,134,119,119,119,177,236,236,236,236,236,236,177,119,119,119,177,236,236,236,185,119,119,119,119,214,236,148,119,119,119,207,236,236,236,236,214,185,141,119,119,119,119,185,236,119,119,119,119,221,236,236,192,119,119,119,192,207,119,119,119,148,236,148,119,119,119,141,199,214,148,119,119,119,177,236,236,156,119,119,156,207,119,119,119,229;236,221,196,203,255,218,196,196,196,196,196,196,196,240,240,226,226,196,196,196,196,196,240,240,196,199,236,236,236,236,236,236,236,119,119,119,119,141,148,148,148,148,148,148,214,185,119,119,119,119,141,221,236,229,163,119,119,119,119,177,236,236,236,236,236,236,177,119,119,119,148,177,163,134,119,119,119,119,141,236,236,148,119,119,119,207,199,148,148,148,185,236,236,185,119,119,119,156,236,119,119,119,119,163,236,229,141,119,119,119,214,207,119,119,119,148,236,119,119,119,119,229,236,236,141,119,119,119,177,236,236,199,119,119,119,170,119,119,141,236;236,233,199,196,233,248,200,196,196,196,196,196,196,229,240,240,240,196,196,196,196,214,255,211,196,211,236,236,236,236,236,236,236,119,119,119,119,119,119,119,119,119,119,119,207,229,134,119,119,119,119,119,119,119,119,119,119,119,119,177,236,236,236,236,236,236,177,119,119,119,119,119,119,119,119,119,119,126,214,236,236,148,119,119,119,207,214,119,119,119,126,199,207,156,119,119,119,163,236,119,119,119,119,119,134,126,119,119,119,134,236,207,119,119,119,148,236,119,119,119,119,170,207,185,119,119,119,119,177,236,236,236,126,119,119,119,119,119,185,236;236,236,216,196,200,251,237,196,196,196,196,196,196,196,196,196,196,196,196,196,207,251,229,196,199,231,236,236,236,236,236,236,236,119,119,119,119,119,119,119,119,119,119,119,207,236,214,126,119,119,119,119,119,119,119,126,119,119,119,177,236,236,236,236,236,236,177,119,119,119,119,119,119,119,119,119,134,214,236,236,236,148,119,119,119,207,236,148,119,119,119,119,119,119,119,119,119,207,236,119,119,119,126,119,119,119,119,119,119,207,236,207,119,119,119,148,236,163,119,119,119,119,119,119,126,119,119,119,177,236,236,236,170,119,119,119,119,119,221,236;236,236,236,204,196,207,251,237,200,196,196,196,196,196,196,196,196,196,196,211,251,244,200,196,216,236,236,236,236,236,236,236,236,119,119,119,119,119,119,119,119,119,119,119,207,236,236,221,148,119,119,119,119,119,163,199,119,119,119,177,236,236,236,236,236,236,177,119,119,119,119,119,119,134,156,192,236,236,236,236,236,148,119,119,119,207,236,229,163,119,119,119,119,119,119,141,207,236,236,119,119,119,148,199,134,119,119,141,207,236,236,207,119,119,119,148,236,229,156,119,119,119,119,163,221,119,119,119,163,236,236,236,214,119,119,119,119,141,236,236;236,236,236,228,199,196,207,251,248,218,196,196,196,196,196,196,196,200,229,255,237,200,196,209,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,221,207,207,207,229,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,207,207,207,221,236,236,236,236,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,221,207,207,229,236,236,236,236,236,236,236,236,236,236,119,119,119,119,177,236,236;236,236,236,236,228,199,196,200,233,255,248,229,218,211,211,222,237,255,251,222,196,196,204,233,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,177,141,119,119,119,119,221,236,236;236,236,236,236,236,228,204,196,196,203,229,240,255,255,255,248,237,218,200,196,196,211,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,177,119,119,119,119,119,177,236,236,236;236,236,236,236,236,236,233,216,199,196,196,196,196,196,196,196,196,196,196,201,226,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,119,119,119,148,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,177,119,119,119,126,185,236,236,236,236;236,236,236,236,236,236,236,236,233,221,209,199,196,196,196,196,201,211,226,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,207,207,214,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,207,207,214,236,236,236,236,236,236];
% logo(:,:,2)=[233,233,233,233,233,233,233,233,219,132,76,18,4,4,4,4,33,90,176,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,233,233,233,233,233,219,118,18,4,4,4,4,4,4,4,4,4,4,33,176,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,233,233,233,233,190,33,4,4,35,145,192,255,255,130,4,4,4,4,4,4,90,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,233,233,233,190,18,4,20,161,255,224,145,98,67,35,4,4,4,4,4,4,4,47,219,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,233,233,190,18,4,51,239,224,98,4,4,4,4,4,4,4,4,4,4,4,4,4,76,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,212,205,205,205,212,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,233,233,47,4,51,239,177,20,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,118,233,233,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,233,233,233,176,134,120,120,120,120,120,127,176,226,233,233,233,233,233,233,233,233,190,148,148,148,148,148,148,148,170,205,233,233,233,233,233,170,148,148,148,212,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,212,148,148,148,170,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,233,118,4,20,239,177,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,18,204,233,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,233,226,141,120,120,120,120,120,120,120,120,120,141,226,233,233,233,233,233,233,233,176,120,120,120,120,120,120,120,120,120,148,219,233,233,233,148,120,120,120,205,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,219,18,4,161,224,20,4,98,192,161,4,4,145,98,4,4,4,4,4,4,4,4,4,4,90,233,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,233,148,120,120,120,120,120,120,120,120,120,120,120,148,233,233,233,233,233,233,233,176,120,120,120,120,120,120,120,120,120,120,127,226,233,233,148,120,120,120,205,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,147,4,35,255,98,4,4,239,255,255,67,4,192,130,4,4,4,4,4,4,4,4,4,4,18,233,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,190,120,120,120,120,141,198,233,198,127,120,120,120,120,212,233,233,233,233,233,233,176,120,120,120,134,148,148,134,120,120,120,120,155,233,233,190,176,176,176,219,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233;233,76,4,145,224,4,4,4,224,255,255,51,4,192,130,4,4,4,4,4,4,4,4,4,4,4,161,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,141,120,120,120,120,219,233,233,233,198,120,120,120,120,183,233,233,233,233,233,233,176,120,120,120,176,233,233,233,183,120,120,120,120,219,233,190,176,176,176,219,233,233,219,163,148,120,120,148,163,219,233,233,233,205,205,205,212,226,190,176,176,205,233,233,233,205,120,120,120,148,233,233,233,226,190,163,148,148,163,190,226,233,226,205,205,205,212,233,233,233,233,219,205,205;233,18,4,192,145,4,4,4,35,130,82,4,4,192,130,4,4,4,4,4,4,4,4,4,4,4,118,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,120,120,120,120,163,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,176,120,120,120,176,233,233,233,233,163,120,120,120,183,233,148,120,120,120,205,233,190,120,120,120,120,120,120,120,120,190,233,233,120,120,120,141,141,120,120,120,120,148,226,233,205,120,120,120,148,233,233,190,127,120,120,120,120,120,120,127,212,233,134,120,120,127,233,233,233,233,163,120,120;233,4,4,255,82,4,4,4,4,4,4,4,4,192,130,4,4,4,4,4,4,4,4,4,4,4,76,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,205,120,120,120,120,190,233,233,219,205,205,205,205,205,205,219,233,233,233,233,233,233,176,120,120,120,176,233,233,233,233,205,120,120,120,163,233,148,120,120,120,205,233,127,120,120,120,170,163,120,120,120,120,226,233,120,120,120,120,120,120,120,120,120,120,170,233,205,120,120,120,148,233,226,127,120,120,120,148,141,120,120,120,127,233,170,120,120,120,212,233,233,233,127,120,120;233,4,4,255,67,4,4,4,4,4,4,4,4,192,130,4,35,130,130,130,130,130,130,130,98,4,61,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,205,120,120,120,120,205,233,233,176,120,120,120,120,120,120,176,233,233,233,233,233,233,176,120,120,120,176,233,233,233,233,219,120,120,120,148,233,148,120,120,120,205,212,120,120,120,148,233,233,176,148,148,148,212,233,120,120,120,120,141,198,190,127,120,120,120,226,205,120,120,120,148,233,205,120,120,120,148,233,233,148,120,120,120,205,212,120,120,120,170,233,233,212,120,120,120;233,4,4,255,67,4,4,4,4,4,4,4,4,192,130,4,51,192,192,192,192,192,192,239,177,4,61,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,205,120,120,120,120,205,233,233,176,120,120,120,120,120,120,176,233,233,233,233,233,233,176,120,120,120,176,233,233,233,233,219,120,120,120,148,233,148,120,120,120,205,233,120,120,120,120,163,198,226,233,233,233,233,233,120,120,120,120,205,233,233,170,120,120,120,205,205,120,120,120,148,233,233,233,233,233,233,233,233,176,120,120,120,176,233,141,120,120,141,233,233,183,120,120,120;233,4,4,255,82,4,4,4,4,4,4,4,4,192,130,4,4,4,4,4,4,4,4,192,130,4,76,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,205,120,120,120,120,190,233,233,190,148,148,134,120,120,120,176,233,233,233,233,233,233,176,120,120,120,176,233,233,233,233,198,120,120,120,155,233,148,120,120,120,205,233,170,120,120,120,120,120,120,148,190,233,233,233,120,120,120,120,233,233,233,205,120,120,120,176,205,120,120,120,148,233,233,233,198,163,148,127,120,120,120,120,120,176,233,183,120,120,120,219,233,155,120,120,155;233,18,4,192,145,4,4,4,4,4,4,4,4,192,130,4,4,4,4,4,4,4,4,239,98,4,118,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,120,120,120,120,163,233,233,233,233,233,176,120,120,120,176,233,233,233,233,233,233,176,120,120,120,176,233,233,233,233,163,120,120,120,176,233,148,120,120,120,205,233,233,190,134,120,120,120,120,120,120,141,226,233,120,120,120,120,233,233,233,205,120,120,120,176,205,120,120,120,148,233,212,141,120,120,120,120,120,120,120,120,120,176,233,226,120,120,120,183,233,127,120,120,190;233,76,4,145,224,4,4,4,4,4,4,4,4,192,130,4,4,4,4,4,4,4,82,255,35,4,161,233,233,233,233,233,233,120,120,120,120,205,233,233,233,233,233,233,233,141,120,120,120,127,226,233,233,233,233,134,120,120,120,176,233,233,233,233,233,233,176,120,120,120,176,233,233,233,183,120,120,120,120,212,233,148,120,120,120,205,233,233,233,233,212,183,141,120,120,120,120,183,233,120,120,120,120,219,233,233,190,120,120,120,190,205,120,120,120,148,233,148,120,120,120,141,198,212,148,120,120,120,176,233,233,155,120,120,155,205,120,120,120,226;233,147,4,35,255,98,4,4,4,4,4,4,4,192,192,130,130,4,4,4,4,4,192,192,4,18,233,233,233,233,233,233,233,120,120,120,120,141,148,148,148,148,148,148,212,183,120,120,120,120,141,219,233,226,163,120,120,120,120,176,233,233,233,233,233,233,176,120,120,120,148,176,163,134,120,120,120,120,141,233,233,148,120,120,120,205,198,148,148,148,183,233,233,183,120,120,120,155,233,120,120,120,120,163,233,226,141,120,120,120,212,205,120,120,120,148,233,120,120,120,120,226,233,233,141,120,120,120,176,233,233,198,120,120,120,170,120,120,141,233;233,219,18,4,161,224,20,4,4,4,4,4,4,145,192,192,192,4,4,4,4,82,255,67,4,90,233,233,233,233,233,233,233,120,120,120,120,120,120,120,120,120,120,120,205,226,134,120,120,120,120,120,120,120,120,120,120,120,120,176,233,233,233,233,233,233,176,120,120,120,120,120,120,120,120,120,120,127,212,233,233,148,120,120,120,205,212,120,120,120,127,198,205,155,120,120,120,163,233,120,120,120,120,120,134,127,120,120,120,134,233,205,120,120,120,148,233,120,120,120,120,170,205,183,120,120,120,120,176,233,233,233,127,120,120,120,120,120,183,233;233,233,118,4,20,239,177,4,4,4,4,4,4,4,4,4,4,4,4,4,51,239,145,4,18,204,233,233,233,233,233,233,233,120,120,120,120,120,120,120,120,120,120,120,205,233,212,127,120,120,120,120,120,120,120,127,120,120,120,176,233,233,233,233,233,233,176,120,120,120,120,120,120,120,120,120,134,212,233,233,233,148,120,120,120,205,233,148,120,120,120,120,120,120,120,120,120,205,233,120,120,120,127,120,120,120,120,120,120,205,233,205,120,120,120,148,233,163,120,120,120,120,120,120,127,120,120,120,176,233,233,233,170,120,120,120,120,120,219,233;233,233,233,47,4,51,239,177,20,4,4,4,4,4,4,4,4,4,4,67,239,208,20,4,118,233,233,233,233,233,233,233,233,120,120,120,120,120,120,120,120,120,120,120,205,233,233,219,148,120,120,120,120,120,163,198,120,120,120,176,233,233,233,233,233,233,176,120,120,120,120,120,120,134,155,190,233,233,233,233,233,148,120,120,120,205,233,226,163,120,120,120,120,120,120,141,205,233,233,120,120,120,148,198,134,120,120,141,205,233,233,205,120,120,120,148,233,226,155,120,120,120,120,163,219,120,120,120,163,233,233,233,212,120,120,120,120,141,233,233;233,233,233,190,18,4,51,239,224,98,4,4,4,4,4,4,4,20,145,255,177,20,4,76,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,219,205,205,205,226,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,205,205,205,219,233,233,233,233,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,219,205,205,226,233,233,233,233,233,233,233,233,233,233,120,120,120,120,176,233,233;233,233,233,233,190,18,4,20,161,255,224,145,98,67,67,114,177,255,239,114,4,4,47,219,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,176,141,120,120,120,120,219,233,233;233,233,233,233,233,190,47,4,4,35,145,192,255,255,255,224,177,98,20,4,4,90,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,176,120,120,120,120,120,176,233,233,233;233,233,233,233,233,233,219,118,18,4,4,4,4,4,4,4,4,4,4,33,176,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,120,120,120,148,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,176,120,120,120,127,183,233,233,233,233;233,233,233,233,233,233,233,233,219,147,76,18,4,4,4,4,33,90,176,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,205,205,212,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,205,205,212,233,233,233,233,233,233];
% logo(:,:,3)=[216,216,216,216,216,216,216,216,208,157,124,90,82,82,82,82,99,132,182,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,216,216,216,216,216,208,149,90,82,82,82,82,82,82,82,82,82,82,99,182,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,216,216,216,216,191,99,82,82,104,179,212,255,255,169,82,82,82,82,82,82,132,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,216,216,216,191,90,82,93,190,255,233,179,147,125,104,82,82,82,82,82,82,82,107,208,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,216,216,191,90,82,114,244,233,147,82,82,82,82,82,82,82,82,82,82,82,82,82,124,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,198,193,193,193,198,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,216,216,107,82,114,244,201,93,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,149,216,216,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,216,216,216,169,135,123,123,123,123,123,129,169,210,216,216,216,216,216,216,216,216,181,146,146,146,146,146,146,146,164,193,216,216,216,216,216,164,146,146,146,198,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,198,146,146,146,164,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,216,149,82,93,244,201,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,82,90,199,216,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,216,210,141,123,123,123,123,123,123,123,123,123,141,210,216,216,216,216,216,216,216,169,123,123,123,123,123,123,123,123,123,146,204,216,216,216,146,123,123,123,193,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,208,90,82,190,233,93,82,147,212,190,82,82,179,147,82,82,82,82,82,82,82,82,82,82,132,216,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,216,146,123,123,123,123,123,123,123,123,123,123,123,146,216,216,216,216,216,216,216,169,123,123,123,123,123,123,123,123,123,123,129,210,216,216,146,123,123,123,193,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,166,82,104,255,147,82,82,244,255,255,125,82,212,169,82,82,82,82,82,82,82,82,82,82,90,216,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,181,123,123,123,123,141,187,216,187,129,123,123,123,123,198,216,216,216,216,216,216,169,123,123,123,135,146,146,135,123,123,123,123,152,216,216,181,169,169,169,204,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216;216,124,82,179,233,82,82,82,233,255,255,114,82,212,169,82,82,82,82,82,82,82,82,82,82,82,174,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,141,123,123,123,123,204,216,216,216,187,123,123,123,123,175,216,216,216,216,216,216,169,123,123,123,169,216,216,216,175,123,123,123,123,204,216,181,169,169,169,204,216,216,204,158,146,123,123,146,158,204,216,216,216,193,193,193,198,210,181,169,169,193,216,216,216,193,123,123,123,146,216,216,216,210,181,158,146,146,158,181,210,216,210,193,193,193,198,216,216,216,216,204,193,193;216,90,82,212,179,82,82,82,104,169,136,82,82,212,169,82,82,82,82,82,82,82,82,82,82,82,149,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,123,123,123,123,158,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,169,123,123,123,169,216,216,216,216,158,123,123,123,175,216,146,123,123,123,193,216,181,123,123,123,123,123,123,123,123,181,216,216,123,123,123,141,141,123,123,123,123,146,210,216,193,123,123,123,146,216,216,181,129,123,123,123,123,123,123,129,198,216,135,123,123,129,216,216,216,216,158,123,123;216,82,82,255,136,82,82,82,82,82,82,82,82,212,169,82,82,82,82,82,82,82,82,82,82,82,124,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,193,123,123,123,123,181,216,216,204,193,193,193,193,193,193,204,216,216,216,216,216,216,169,123,123,123,169,216,216,216,216,193,123,123,123,158,216,146,123,123,123,193,216,129,123,123,123,164,158,123,123,123,123,210,216,123,123,123,123,123,123,123,123,123,123,164,216,193,123,123,123,146,216,210,129,123,123,123,146,141,123,123,123,129,216,164,123,123,123,198,216,216,216,129,123,123;216,82,82,255,125,82,82,82,82,82,82,82,82,212,169,82,104,169,169,169,169,169,169,169,147,82,116,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,193,123,123,123,123,193,216,216,169,123,123,123,123,123,123,169,216,216,216,216,216,216,169,123,123,123,169,216,216,216,216,204,123,123,123,146,216,146,123,123,123,193,198,123,123,123,146,216,216,169,146,146,146,198,216,123,123,123,123,141,187,181,129,123,123,123,210,193,123,123,123,146,216,193,123,123,123,146,216,216,146,123,123,123,193,198,123,123,123,164,216,216,198,123,123,123;216,82,82,255,125,82,82,82,82,82,82,82,82,212,169,82,114,212,212,212,212,212,212,244,201,82,116,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,193,123,123,123,123,193,216,216,169,123,123,123,123,123,123,169,216,216,216,216,216,216,169,123,123,123,169,216,216,216,216,204,123,123,123,146,216,146,123,123,123,193,216,123,123,123,123,158,187,210,216,216,216,216,216,123,123,123,123,193,216,216,164,123,123,123,193,193,123,123,123,146,216,216,216,216,216,216,216,216,169,123,123,123,169,216,141,123,123,141,216,216,175,123,123,123;216,82,82,255,136,82,82,82,82,82,82,82,82,212,169,82,82,82,82,82,82,82,82,212,169,82,124,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,193,123,123,123,123,181,216,216,181,146,146,135,123,123,123,169,216,216,216,216,216,216,169,123,123,123,169,216,216,216,216,187,123,123,123,152,216,146,123,123,123,193,216,164,123,123,123,123,123,123,146,181,216,216,216,123,123,123,123,216,216,216,193,123,123,123,169,193,123,123,123,146,216,216,216,187,158,146,129,123,123,123,123,123,169,216,175,123,123,123,204,216,152,123,123,152;216,90,82,212,179,82,82,82,82,82,82,82,82,212,169,82,82,82,82,82,82,82,82,244,147,82,149,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,123,123,123,123,158,216,216,216,216,216,169,123,123,123,169,216,216,216,216,216,216,169,123,123,123,169,216,216,216,216,158,123,123,123,169,216,146,123,123,123,193,216,216,181,135,123,123,123,123,123,123,141,210,216,123,123,123,123,216,216,216,193,123,123,123,169,193,123,123,123,146,216,198,141,123,123,123,123,123,123,123,123,123,169,216,210,123,123,123,175,216,129,123,123,181;216,124,82,179,233,82,82,82,82,82,82,82,82,212,169,82,82,82,82,82,82,82,136,255,104,82,174,216,216,216,216,216,216,123,123,123,123,193,216,216,216,216,216,216,216,141,123,123,123,129,210,216,216,216,216,135,123,123,123,169,216,216,216,216,216,216,169,123,123,123,169,216,216,216,175,123,123,123,123,198,216,146,123,123,123,193,216,216,216,216,198,175,141,123,123,123,123,175,216,123,123,123,123,204,216,216,181,123,123,123,181,193,123,123,123,146,216,146,123,123,123,141,187,198,146,123,123,123,169,216,216,152,123,123,152,193,123,123,123,210;216,166,82,104,255,147,82,82,82,82,82,82,82,212,212,169,169,82,82,82,82,82,212,212,82,90,216,216,216,216,216,216,216,123,123,123,123,141,146,146,146,146,146,146,198,175,123,123,123,123,141,204,216,210,158,123,123,123,123,169,216,216,216,216,216,216,169,123,123,123,146,169,158,135,123,123,123,123,141,216,216,146,123,123,123,193,187,146,146,146,175,216,216,175,123,123,123,152,216,123,123,123,123,158,216,210,141,123,123,123,198,193,123,123,123,146,216,123,123,123,123,210,216,216,141,123,123,123,169,216,216,187,123,123,123,164,123,123,141,216;216,208,90,82,190,233,93,82,82,82,82,82,82,179,212,212,212,82,82,82,82,136,255,125,82,132,216,216,216,216,216,216,216,123,123,123,123,123,123,123,123,123,123,123,193,210,135,123,123,123,123,123,123,123,123,123,123,123,123,169,216,216,216,216,216,216,169,123,123,123,123,123,123,123,123,123,123,129,198,216,216,146,123,123,123,193,198,123,123,123,129,187,193,152,123,123,123,158,216,123,123,123,123,123,135,129,123,123,123,135,216,193,123,123,123,146,216,123,123,123,123,164,193,175,123,123,123,123,169,216,216,216,129,123,123,123,123,123,175,216;216,216,149,82,93,244,201,82,82,82,82,82,82,82,82,82,82,82,82,82,114,244,179,82,90,199,216,216,216,216,216,216,216,123,123,123,123,123,123,123,123,123,123,123,193,216,198,129,123,123,123,123,123,123,123,129,123,123,123,169,216,216,216,216,216,216,169,123,123,123,123,123,123,123,123,123,135,198,216,216,216,146,123,123,123,193,216,146,123,123,123,123,123,123,123,123,123,193,216,123,123,123,129,123,123,123,123,123,123,193,216,193,123,123,123,146,216,158,123,123,123,123,123,123,129,123,123,123,169,216,216,216,164,123,123,123,123,123,204,216;216,216,216,107,82,114,244,201,93,82,82,82,82,82,82,82,82,82,82,125,244,223,93,82,149,216,216,216,216,216,216,216,216,123,123,123,123,123,123,123,123,123,123,123,193,216,216,204,146,123,123,123,123,123,158,187,123,123,123,169,216,216,216,216,216,216,169,123,123,123,123,123,123,135,152,181,216,216,216,216,216,146,123,123,123,193,216,210,158,123,123,123,123,123,123,141,193,216,216,123,123,123,146,187,135,123,123,141,193,216,216,193,123,123,123,146,216,210,152,123,123,123,123,158,204,123,123,123,158,216,216,216,198,123,123,123,123,141,216,216;216,216,216,191,90,82,114,244,233,147,82,82,82,82,82,82,82,93,179,255,201,93,82,124,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,204,193,193,193,210,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,193,193,193,204,216,216,216,216,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,204,193,193,210,216,216,216,216,216,216,216,216,216,216,123,123,123,123,169,216,216;216,216,216,216,191,90,82,93,190,255,233,179,147,125,125,158,201,255,244,158,82,82,107,208,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,169,141,123,123,123,123,204,216,216;216,216,216,216,216,191,107,82,82,104,179,212,255,255,255,233,201,147,93,82,82,132,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,169,123,123,123,123,123,169,216,216,216;216,216,216,216,216,216,208,149,90,82,82,82,82,82,82,82,82,82,82,99,182,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,123,123,123,146,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,169,123,123,123,129,175,216,216,216,216;216,216,216,216,216,216,216,216,208,166,124,90,82,82,82,82,99,132,182,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,193,193,198,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,193,193,198,216,216,216,216,216,216];
% 
% imagesc(uint8(logo),'Parent',handles.logo1);

set(handles.rawdataaxes1,'XTickLabel',[],'YTickLabel',[])
set(handles.rmsbar1,'XTickLabel',[],'YTickLabel',[])
set(handles.segmentationaxes1,'XTickLabel',[],'YTickLabel',[])
set(handles.spectrogramaxes1,'XTickLabel',[],'YTickLabel',[])
set(handles.rmscomparisonaxesx,'XTickLabel',[],'YTickLabel',[])
set(handles.rmscomparisonaxesy,'XTickLabel',[],'YTickLabel',[])
set(handles.rmscomparisonaxesz,'XTickLabel',[],'YTickLabel',[])
set(handles.rawdataaxes2,'XTickLabel',[],'YTickLabel',[])
set(handles.rmsbar2,'XTickLabel',[],'YTickLabel',[])
set(handles.segmentationaxes2,'XTickLabel',[],'YTickLabel',[])
set(handles.spectrogramaxes2,'XTickLabel',[],'YTickLabel',[])
set(handles.logo1,'XTickLabel',[],'YTickLabel',[])
axis(handles.logo1,'off')

% --- Executes on button press in openfile1.
function openfile1_Callback(hObject, eventdata, handles)
% hObject    handle to openfile1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    [FileName,PathName,FilterIndex] = uigetfile('*.txt','Select data file');
    if FileName~=0
        userdata.pathname=PathName;
        userdata.filename=FileName;
        pathfile=[PathName,FileName];
        D=dir(pathfile);
        bytes=D.bytes;
        fid=fopen(pathfile);
        h = waitbar(0,'Data Loading...');
        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        jframe=get(h,'javaframe');
        jIcon=javax.swing.ImageIcon('logoonly.png');
        jframe.setFigureIcon(jIcon);
        datas=[];
        jj=0;
        ewsid=textscan(fid,'%d %f',1);
        pmsid=textscan(fid,'%d %s %f',1);
        stateid.ewsid=ewsid{1};
        stateid.ewsprob=ewsid{2};
        stateid.pmsid=pmsid{1};
        stateid.pmspart=pmsid{2};
        stateid.pmsprob=pmsid{3};
        set(handles.openfile1,'UserData',stateid);
        while 1
            C1=textscan(fid,'%f %f %f',1000);
            nt=length(C1{1});
            fidx=ftell(fid);
            datas(jj+1:jj+nt,:)=[C1{1} C1{2} C1{3}];
            jj=jj+nt;
            %             datas=[datas;C1{1} C1{2} C1{3}];
            waitbar(fidx/bytes,h)
            if fidx>=bytes
                fclose(fid);
                close(h)
                break;
            end
        end
        userdata.data=datas;
        userdata.scrsz = get(0,'ScreenSize');
        userdata.Fs=3000;
        userdata.xlabel='Time (second)';
        userdata.ylabel='Acceleration (g)';
        userdata.legend={'X-dir','Y-dir','Z-dir'};
        Fs=3000;
        dt=1/Fs;
        userdata.t=0:dt:(length(userdata.data)-1)*dt;
        abstr=[userdata.pathname,userdata.filename];
        set(handles.filename1,'String',abstr);
        plot(handles.rawdataaxes1,userdata.t,userdata.data)
        set(handles.rawdataaxes1,'XLim',[userdata.t(1) userdata.t(end)])
        xlsdata=get(handles.xlsreport1,'UserData');
        xlsdata.path=[PathName,FileName];
        set(handles.xlsreport1,'UserData',xlsdata);
        set(handles.nw1,'UserData',userdata)
    end
catch me
    errordlg(me.message)
end

function openfile2_Callback(hObject, eventdata, handles)
% hObject    handle to openfile2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    [FileName,PathName,FilterIndex] = uigetfile('*.txt','Select data file');
    if FileName~=0
        userdata.pathname=PathName;
        userdata.filename=FileName;
        pathfile=[PathName,FileName];
        D=dir(pathfile);
        bytes=D.bytes;
        fid=fopen(pathfile);
        h = waitbar(0,'Data Loading...');
        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        jframe=get(h,'javaframe');
        jIcon=javax.swing.ImageIcon('logoonly.png');
        jframe.setFigureIcon(jIcon);
        datas=[];
        jj=0;
        ewsid=textscan(fid,'%d %f',1);
        pmsid=textscan(fid,'%d %s %f',1);
        stateid.ewsid=ewsid{1};
        stateid.ewsprob=ewsid{2};
        stateid.pmsid=pmsid{1};
        stateid.pmspart=pmsid{2};
        stateid.pmsprob=pmsid{3};
        set(handles.openfile2,'UserData',stateid);
        while 1
            C1=textscan(fid,'%f %f %f',1000);
            nt=length(C1{1});
            fidx=ftell(fid);
            datas(jj+1:jj+nt,:)=[C1{1} C1{2} C1{3}];
            jj=jj+nt;
            waitbar(fidx/bytes,h)
            if fidx>=bytes
                fclose(fid);
                close(h)
                break;
            end
        end
        userdata.data=datas;
        userdata.scrsz = get(0,'ScreenSize');
        userdata.Fs=3000;
        userdata.xlabel='Time (second)';
        userdata.ylabel='Acceleration (g)';
        userdata.legend={'X-dir','Y-dir','Z-dir'};
        Fs=3000;
        dt=1/Fs;
        userdata.t=0:dt:(length(userdata.data)-1)*dt;
        abstr=[userdata.pathname,userdata.filename];
        set(handles.filename2,'String',abstr);
        plot(handles.rawdataaxes2,userdata.t,userdata.data)
        set(handles.rawdataaxes2,'XLim',[userdata.t(1) userdata.t(end)])
        xlsdata=get(handles.xlsreport2,'UserData');
        xlsdata.path=[PathName,FileName];
        set(handles.xlsreport2,'UserData',xlsdata);
        set(handles.nw2,'UserData',userdata)
    end
catch me
    errordlg(me.message)
end

function filename1_Callback(hObject, eventdata, handles)
% hObject    handle to filename1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of filename1 as text
%        str2double(get(hObject,'String')) returns contents of filename1 as a double
% userdata=get(handles.nw1,'UserData');
% if ~isempty(userdata)
%     abstr=[userdata.pathname,userdata.filename];
%     set(handles.filename1,'String',abstr);
% end

% --- Executes during object creation, after setting all properties.
function filename1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to filename1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function filename2_Callback(hObject, eventdata, handles)
% hObject    handle to filename2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of filename2 as text
%        str2double(get(hObject,'String')) returns contents of filename2 as a double


% --- Executes during object creation, after setting all properties.
function filename2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to filename2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on button press in segmentationbtn1.
function segmentationbtn1_Callback(hObject, eventdata, handles)
% hObject    handle to segmentationbtn1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    % input variables check
    tgtcol=get(handles.chanelselection1,'UserData');
    if isempty(tgtcol)
        tgtcol=1;
    end
    processview=get(handles.checkbox1,'Value');
    
    
    errchk=0;
    sbuffersize=get(handles.bufferblocksize1,'String');
    if ~isempty(sbuffersize)
        buffersize=str2double(sbuffersize);
        if isnan(buffersize)
            errordlg('buffer block size must be a number.  Restoring default value as 5000');
            set(handles.bufferblocksize1,'String','5000');
            errchk=1;
        end
    else
        errordlg('Buffer block size is empty. Restoring default value as 5000');
        set(handles.bufferblocksize1,'String','5000');
        errchk=1;
    end
    
    sbufferoverlapsize=get(handles.bufferblockoverlapsize1,'String');
    if ~isempty(sbufferoverlapsize)
        bufferoverlapsize=str2double(sbufferoverlapsize);
        if isnan(bufferoverlapsize)
            errordlg('Buffer overlap size must be a number.  Restoring default value as 150');
            set(handles.bufferblockoverlapsize1,'String','150');
            errchk=1;
        end
    else
        errordlg('Buffer overlap size is empty. Restoring default value as 150');
        set(handles.bufferblockoverlapsize1,'String','150');
        errchk=1;
    end
    
    ssegstarthresh=get(handles.segstarthresh1,'String');
    if ~isempty(ssegstarthresh)
        segstarthresh=str2double(ssegstarthresh);
        if isnan(segstarthresh)
            errordlg('Segment starting threshold value must be a number. Restoring default value as 0.01');
            set(handles.segstarthresh1,'String','0.01');
            errchk=1;
        end
    else
        errordlg('Segment starting threshold is empty. Restoring default value as 0.01');
        set(handles.segstarthresh1,'String','0.01');
        errchk=1;
    end
    
    ssegendthresh=get(handles.segendthresh1,'String');
    if ~isempty(ssegendthresh)
        segendthresh=str2double(ssegendthresh);
        if isnan(segendthresh)
            errordlg('Segment ending threshold value must be a number. Restoring default value as 0.01');
            set(handles.segendthresh1,'String','0.01');
            errchk=1;
        end
    else
        errordlg('Segment ending threshold is empty. Restoring default value as 0.01');
        set(handles.segendhresh1,'String','0.01');
        errchk=1;
    end
    
    smargin=get(handles.margin1,'String');
    if ~isempty(smargin)
        margin=str2double(smargin);
        if isnan(margin)
            errordlg('Margin of segmented samples must be a integer number over 1. Restoring default value as 1000');
            set(handles.margin1,'String','1000');
            errchk=1;
        end
    else
        errordlg('Margin of segmented samples is empty. Restoring default value as 1000');
        set(handles.margin1,'String','1000');
        errchk=1;
    end
    
    if ~(errchk)
        
        if buffersize>bufferoverlapsize
            userdata=get(handles.nw1,'UserData');
            if ~isempty(userdata)
                [ur,uc]=size(userdata.data);
                if ~isempty(userdata)
                    bufferoverlap=buffersize-bufferoverlapsize;
                    data=userdata.data;
                    Fs=userdata.Fs;
                    t=userdata.t;
                    
                    bfdata=buffer(data(:,tgtcol),buffersize,bufferoverlap);
                    [br,bc]=size(bfdata);
                    dbt=bufferoverlapsize/Fs;
                    bt=0:dbt:(bc-1)*dbt;
                    
                    if length(bt)>bc,bt=bt(1:end-1); end
                    
                    h = waitbar(0,'Data Segmentation...');
                    warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
                    jframe=get(h,'javaframe');
                    jIcon=javax.swing.ImageIcon('logoonly.png');
                    jframe.setFigureIcon(jIcon);
                    for kk=1:bc
                        rmsval(kk)=std(bfdata(:,kk));
                        peakval(kk)=max(abs(bfdata(:,kk)));
                        waitbar(kk/bc,h)
                    end
                    close(h)
                    [ri,ci,val]=find(diff(sign(rmsval-segstarthresh)));
                    ii=0;jj=0;
                    for kk=1:length(ci)
                        if val(kk)>0
                            ii=ii+1;
                            strgidxst(ii)=ci(kk);
                        else
                            jj=jj+1;
                            etrgidxst(jj)=ci(kk);
                        end
                    end
                    
                    [ri,ci,val]=find(diff(sign(rmsval-segendthresh)));
                    ii=0;jj=0;
                    for kk=1:length(ci)
                        if val(kk)>0
                            ii=ii+1;
                            strgidxen(ii)=ci(kk);
                        else
                            jj=jj+1;
                            etrgidxen(jj)=ci(kk);
                        end
                    end
                    if processview==1
                        h=figure;
                        subplot(212)
                        plot(bt,rmsval,'k',[bt(1) bt(end)],[segstarthresh segstarthresh],':r',[bt(1) bt(end)],[segendthresh segendthresh],':b',bt(strgidxst),rmsval(strgidxst),'or',bt(etrgidxst),rmsval(etrgidxst),'xr',bt(strgidxen),rmsval(strgidxen),'ob',bt(etrgidxen),rmsval(etrgidxen),'xb')
                        xlabel('Time(second)'),ylabel('RMS Level of Acc. (g)'),legend('RMS Level of Target Column','Start threshold In','Start threshold Out','End threshold In','End threshold Out')
                        %                     h=get(gcf);
                        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
                        jframe=get(h,'javaframe');
                        jIcon=javax.swing.ImageIcon('logoonly.png');
                        jframe.setFigureIcon(jIcon);
                    end
                    terrchk=0;
                    if isempty(strgidxst),errordlg('No start threshold bound!'),terrchk=1; end
                    if isempty(etrgidxst),errordlg('No start threshold bound!'),terrchk=1; end
                    if isempty(strgidxen),errordlg('No start threshold bound!'),terrchk=1; end
                    if isempty(etrgidxen),errordlg('No start threshold bound!'),terrchk=1; end
                    if ~(terrchk)
                        stbufid=find(bfdata(:,1));
                        firstbuffersize=buffersize-stbufid(1);
                        
                        datatrgstidstart=strgidxst*bufferoverlapsize-firstbuffersize;
                        datatrgenidstart=etrgidxst*bufferoverlapsize-firstbuffersize;
                        datatrgstidend=strgidxen*bufferoverlapsize-firstbuffersize;
                        datatrgenidend=etrgidxen*bufferoverlapsize-firstbuffersize;
                        if processview==1
                            subplot(211),plot(t,data(:,tgtcol),':c',t(datatrgstidstart),data(datatrgstidstart,tgtcol),'or',t(datatrgenidstart),data(datatrgenidstart,tgtcol),'xr',t(datatrgstidend),data(datatrgstidend,tgtcol),'ob',t(datatrgenidend),data(datatrgenidend,tgtcol),'xb')
                            xlabel('Time(second)'),ylabel('Rawdata of Acc. (g)'),legend('RMS Level of Target Column','Start threshold In','Start threshold Out','End threshold In','End threshold Out')
                        end
                        %                 for ii=1:length(datatrgstidstart)
                        %                     size(datatrgstidstart)
                        %                     size(datatrgenidstart)
                        for kk=1:min(length(datatrgstidstart),length(datatrgenidstart))
                            if ssegendthresh<=ssegstarthresh
                                [mval1,mind1]=min(abs(datatrgenidend-datatrgenidstart(kk)));
                                endtrgid(kk)=datatrgenidend(mind1);
                                %                             endtrgid(kk)=datatrgenidend(find(diff(sign(datatrgenidend-datatrgenidstart(kk))))+1);
                                %                             figure,plot(diff(sign(datatrgenidend-datatrge
                                %                             nidstart(kk))))
                            else
                                [mval2,mind2]=min(abs(datatrgenidend-datatrgstidstart(kk)));
                                endtrgid(kk)=datatrgenidend(mind2);
                                %                             endtrgid(kk)=datatrgenidend(find(diff(sign(datatrgenidend-datatrgstidstart(kk))))+1);
                                
                                %                             figure,plot(diff(sign(datatrgenidend-datatrgstidstart(kk))))
                            end
                        end
                        
                        mssize=length(find(datatrgstidstart<=margin));
                        
                        if mssize<=1
                            %
                            starttrgidfin=datatrgstidstart-margin;
                            if datatrgstidstart(1)<=margin,starttrgid(1)=1; end
                            %                         starttrgid(find(sign(starttrgid)+1))=1;
                        else
                            errordlg('Margin size should be lower than first start segmentation index!'),merrchk=1;
                        end
                        
                        mesize=length(find(endtrgid+margin>ur));
                        
                        if mesize<=1
                            endtrgidfin=endtrgid+margin;
                            if endtrgidfin(end)>ur, endtrgidfin(end)=ur; end
                        else
                            errordlg('Margin size should be lower than first end segmentation index!'),merrchk=1;
                        end
                        if processview==1
                            h=figure;
                            subplot(211)
                            plot(t,data(:,tgtcol),':c',t(datatrgstidstart),data(datatrgstidstart,tgtcol),'or',t(datatrgenidstart),data(datatrgenidstart,tgtcol),'xr',t(datatrgstidend),data(datatrgstidend,tgtcol),'ob',t(datatrgenidend),data(datatrgenidend,tgtcol),'xb')
                            xlabel('Time(second)'),ylabel('Acceleration (g)'),title('No Margin')
                            legend('Rawdata','Start threshold','End threshold')
                            subplot(212)
                            plot(t,data(:,tgtcol),':c',t(starttrgidfin),data(starttrgidfin,tgtcol),'or',t(endtrgidfin),data(endtrgidfin,tgtcol),'xb')
                            xlabel('Time(second)'),ylabel('Acceleration (g)'),title('Margin')
                            legend('Rawdata','Start threshold','End threshold')
                            %                         h=get(gcf);
                            warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
                            jframe=get(h,'javaframe');
                            jIcon=javax.swing.ImageIcon('logoonly.png');
                            jframe.setFigureIcon(jIcon);
                        end
                        %                     intvec=datatrgenidend-datatrgstidstart(ii);
                        %                     indiceval=find(diff(sign(intvec)))
                        %                     if ~isempty(indiceval)
                        %                         datatrgendindex(ii)=datatrgenidend(indiceval+1);
                        %                     else
                        %                         [val,idx]=min(intvec);
                        %                         datatrgendindex(ii)=datatrgenidend(idx);
                        %                     end
                        %                 end
                        % length(starttrgidfin)
                        % length(endtrgidfin)
                        notrg=min(length(starttrgidfin),length(endtrgidfin));
                        set(handles.nosegment1,'String',notrg);
                        
                        %                 starttrgidfin
                        %                 endtrgidfin
                        %
                        %                 endtrgidfin-starttrgidfin
                        for ii=1:notrg
                            segdata{ii}=data(starttrgidfin(ii):endtrgidfin(ii),:);
                            segstr{ii}=['Segment ',num2str(ii,'%02d')];
                            serrms(ii)=norm(segdata{ii})/sqrt(length(segdata{ii}));
                            for jj=1:3
                                segrms(ii,jj)=norm(segdata{ii}(:,jj))/sqrt(length(segdata{ii}));
                            end
                            centime(ii)=(starttrgidfin(ii)+endtrgidfin(ii))/2*(1/Fs);
                        end
                        set(handles.segmentationbtn1,'UserData',segdata);
                        xlsdata=get(handles.xlsreport1,'UserData');
                        xlsdata.segrms=segrms;
                        set(handles.xlsreport1,'UserData',xlsdata);
                        
                        set(handles.rmstable1,'Data',segrms);
                        bar(centime,serrms,'Parent',handles.rmsbar1);
                        %                 for ii=1:notrg
                        %                     text(starttrgidfin(ii)/Fs,serrms(ii)*0.1+serrms(ii),num2str(serrms(ii),'%.2f'),'Parent',handles.rmsbar1)
                        %                 end
                        set(handles.rmsbar1,'XLim',[t(1) t(end)]);
                        set(handles.rmsbar1,'YTickLabel',[]);
                        
                        set(handles.popup1,'Value',1)
                        set(handles.popup1,'String',segstr);
                    else
                        errordlg('There are something not bounded threshold value!. Please adjust the threshold values')
                        errchk=1;
                    end
                end
            end
        else
            errordlg('Buffer overlap size should be smaller than buffer size')
            set(handles.bufferblocksize1,'String','5000');
            set(handles.bufferblockoverlapsize1,'String','150');
            
        end
    end
    % buffersize=num2
catch me
    errordlg(me.message)
end

% --- Executes on button press in segmentationbtn1.
function segmentationbtn2_Callback(hObject, eventdata, handles)
% hObject    handle to segmentationbtn1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    % input variables check
    tgtcol=get(handles.chanelselection2,'UserData');
    if isempty(tgtcol)
        tgtcol=1;
    end
    processview=get(handles.checkbox2,'Value');
    
    
    errchk=0;
    sbuffersize=get(handles.bufferblocksize2,'String');
    if ~isempty(sbuffersize)
        buffersize=str2double(sbuffersize);
        if isnan(buffersize)
            errordlg('buffer block size must be a number.  Restoring default value as 5000');
            set(handles.bufferblocksize2,'String','5000');
            errchk=1;
        end
    else
        errordlg('Buffer block size is empty. Restoring default value as 5000');
        set(handles.bufferblocksize2,'String','5000');
        errchk=1;
    end
    
    sbufferoverlapsize=get(handles.bufferblockoverlapsize2,'String');
    if ~isempty(sbufferoverlapsize)
        bufferoverlapsize=str2double(sbufferoverlapsize);
        if isnan(bufferoverlapsize)
            errordlg('Buffer overlap size must be a number.  Restoring default value as 150');
            set(handles.bufferblockoverlapsize2,'String','150');
            errchk=1;
        end
    else
        errordlg('Buffer overlap size is empty. Restoring default value as 150');
        set(handles.bufferblockoverlapsize2,'String','150');
        errchk=1;
    end
    
    ssegstarthresh=get(handles.segstarthresh2,'String');
    if ~isempty(ssegstarthresh)
        segstarthresh=str2double(ssegstarthresh);
        if isnan(segstarthresh)
            errordlg('Segment starting threshold value must be a number. Restoring default value as 0.01');
            set(handles.segstarthresh2,'String','0.01');
            errchk=1;
        end
    else
        errordlg('Segment starting threshold is empty. Restoring default value as 0.01');
        set(handles.segstarthresh2,'String','0.01');
        errchk=1;
    end
    
    ssegendthresh=get(handles.segendthresh2,'String');
    if ~isempty(ssegendthresh)
        segendthresh=str2double(ssegendthresh);
        if isnan(segendthresh)
            errordlg('Segment ending threshold value must be a number. Restoring default value as 0.01');
            set(handles.segendthresh2,'String','0.01');
            errchk=1;
        end
    else
        errordlg('Segment ending threshold is empty. Restoring default value as 0.01');
        set(handles.segendhresh2,'String','0.01');
        errchk=1;
    end
    
    smargin=get(handles.margin2,'String');
    if ~isempty(smargin)
        margin=str2double(smargin);
        if isnan(margin)
            errordlg('Margin of segmented samples must be a integer number over 1. Restoring default value as 1000');
            set(handles.margin2,'String','1000');
            errchk=1;
        end
    else
        errordlg('Margin of segmented samples is empty. Restoring default value as 1000');
        set(handles.margin2,'String','1000');
        errchk=1;
    end
    
    if ~(errchk)
        
        if buffersize>bufferoverlapsize
            userdata=get(handles.nw2,'UserData');
            if ~isempty(userdata)
                [ur,uc]=size(userdata.data);
                if ~isempty(userdata)
                    bufferoverlap=buffersize-bufferoverlapsize;
                    data=userdata.data;
                    Fs=userdata.Fs;
                    t=userdata.t;
                    
                    bfdata=buffer(data(:,tgtcol),buffersize,bufferoverlap);
                    [br,bc]=size(bfdata);
                    dbt=bufferoverlapsize/Fs;
                    bt=0:dbt:(bc-1)*dbt;
                    
                    if length(bt)>bc,bt=bt(1:end-1); end
                    
                    h = waitbar(0,'Data Segmentation...');
                    warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
                    jframe=get(h,'javaframe');
                    jIcon=javax.swing.ImageIcon('logoonly.png');
                    jframe.setFigureIcon(jIcon);
                    for kk=1:bc
                        rmsval(kk)=std(bfdata(:,kk));
                        peakval(kk)=max(abs(bfdata(:,kk)));
                        waitbar(kk/bc,h)
                    end
                    close(h)
                    [ri,ci,val]=find(diff(sign(rmsval-segstarthresh)));
                    ii=0;jj=0;
                    for kk=1:length(ci)
                        if val(kk)>0
                            ii=ii+1;
                            strgidxst(ii)=ci(kk);
                        else
                            jj=jj+1;
                            etrgidxst(jj)=ci(kk);
                        end
                    end
                    
                    [ri,ci,val]=find(diff(sign(rmsval-segendthresh)));
                    ii=0;jj=0;
                    for kk=1:length(ci)
                        if val(kk)>0
                            ii=ii+1;
                            strgidxen(ii)=ci(kk);
                        else
                            jj=jj+1;
                            etrgidxen(jj)=ci(kk);
                        end
                    end
                    if processview==1
                        h=figure;
                        subplot(212)
                        plot(bt,rmsval,'k',[bt(1) bt(end)],[segstarthresh segstarthresh],':r',[bt(1) bt(end)],[segendthresh segendthresh],':b',bt(strgidxst),rmsval(strgidxst),'or',bt(etrgidxst),rmsval(etrgidxst),'xr',bt(strgidxen),rmsval(strgidxen),'ob',bt(etrgidxen),rmsval(etrgidxen),'xb')
                        xlabel('Time(second)'),ylabel('RMS Level of Acc. (g)'),legend('RMS Level of Target Column','Start threshold In','Start threshold Out','End threshold In','End threshold Out')
                        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
                        jframe=get(h,'javaframe');
                        jIcon=javax.swing.ImageIcon('logoonly.png');
                        jframe.setFigureIcon(jIcon);
                    end
                    terrchk=0;
                    if isempty(strgidxst),errordlg('No start threshold bound!'),terrchk=1;end
                    if isempty(etrgidxst),errordlg('No start threshold bound!'),terrchk=1;end
                    if isempty(strgidxen),errordlg('No start threshold bound!'),terrchk=1;end
                    if isempty(etrgidxen),errordlg('No start threshold bound!'),terrchk=1;end
                    if ~(terrchk)
                        stbufid=find(bfdata(:,1));
                        firstbuffersize=buffersize-stbufid(1);
                        
                        datatrgstidstart=strgidxst*bufferoverlapsize-firstbuffersize;
                        datatrgenidstart=etrgidxst*bufferoverlapsize-firstbuffersize;
                        datatrgstidend=strgidxen*bufferoverlapsize-firstbuffersize;
                        datatrgenidend=etrgidxen*bufferoverlapsize-firstbuffersize;
                        if processview==1
                            subplot(211),plot(t,data(:,tgtcol),':c',t(datatrgstidstart),data(datatrgstidstart,tgtcol),'or',t(datatrgenidstart),data(datatrgenidstart,tgtcol),'xr',t(datatrgstidend),data(datatrgstidend,tgtcol),'ob',t(datatrgenidend),data(datatrgenidend,tgtcol),'xb')
                            xlabel('Time(second)'),ylabel('Rawdata of Acc. (g)'),legend('RMS Level of Target Column','Start threshold In','Start threshold Out','End threshold In','End threshold Out')
                        end
                        %                 for ii=1:length(datatrgstidstart)
                        %                     size(datatrgstidstart)
                        %                     size(datatrgenidstart)
                        for kk=1:min(length(datatrgstidstart),length(datatrgenidstart))
                            if ssegendthresh<=ssegstarthresh
                                [mval1,mind1]=min(abs(datatrgenidend-datatrgenidstart(kk)));
                                endtrgid(kk)=datatrgenidend(mind1);
                                %                             endtrgid(kk)=datatrgenidend(find(diff(sign(datatrgenidend-datatrgenidstart(kk))))+1);
                                %                             figure,plot(diff(sign(datatrgenidend-datatrge
                                %                             nidstart(kk))))
                            else
                                [mval2,mind2]=min(abs(datatrgenidend-datatrgstidstart(kk)));
                                endtrgid(kk)=datatrgenidend(mind2);
                                %                             endtrgid(kk)=datatrgenidend(find(diff(sign(datatrgenidend-datatrgstidstart(kk))))+1);
                                
                                %                             figure,plot(diff(sign(datatrgenidend-datatrgstidstart(kk))))
                            end
                        end
                        
                        mssize=length(find(datatrgstidstart<=margin));
                        
                        if mssize<=1
                            %
                            starttrgidfin=datatrgstidstart-margin;
                            if datatrgstidstart(1)<=margin,starttrgid(1)=1; end
                            %                         starttrgid(find(sign(starttrgid)+1))=1;
                        else
                            errordlg('Margin size should be lower than first start segmentation index!'),merrchk=1;
                        end
                        
                        mesize=length(find(endtrgid+margin>ur));
                        
                        if mesize<=1
                            endtrgidfin=endtrgid+margin;
                            if endtrgidfin(end)>ur, endtrgidfin(end)=ur; end
                        else
                            errordlg('Margin size should be lower than first end segmentation index!'),merrchk=1;
                        end
                        if processview==1
                            h=figure';
                            subplot(211)
                            plot(t,data(:,tgtcol),':c',t(datatrgstidstart),data(datatrgstidstart,tgtcol),'or',t(datatrgenidstart),data(datatrgenidstart,tgtcol),'xr',t(datatrgstidend),data(datatrgstidend,tgtcol),'ob',t(datatrgenidend),data(datatrgenidend,tgtcol),'xb')
                            xlabel('Time(second)'),ylabel('Acceleration (g)'),title('No Margin')
                            legend('Rawdata','Start threshold','End threshold')
                            subplot(212)
                            plot(t,data(:,tgtcol),':c',t(starttrgidfin),data(starttrgidfin,tgtcol),'or',t(endtrgidfin),data(endtrgidfin,tgtcol),'xb')
                            xlabel('Time(second)'),ylabel('Acceleration (g)'),title('Margin')
                            legend('Rawdata','Start threshold','End threshold')
                            warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
                            jframe=get(h,'javaframe');
                            jIcon=javax.swing.ImageIcon('logoonly.png');
                            jframe.setFigureIcon(jIcon);
                        end
                        %                     intvec=datatrgenidend-datatrgstidstart(ii);
                        %                     indiceval=find(diff(sign(intvec)))
                        %                     if ~isempty(indiceval)
                        %                         datatrgendindex(ii)=datatrgenidend(indiceval+1);
                        %                     else
                        %                         [val,idx]=min(intvec);
                        %                         datatrgendindex(ii)=datatrgenidend(idx);
                        %                     end
                        %                 end
                        % length(starttrgidfin)
                        % length(endtrgidfin)
                        notrg=min(length(starttrgidfin),length(endtrgidfin));
                        set(handles.nosegment2,'String',notrg);
                        
                        %                 starttrgidfin
                        %                 endtrgidfin
                        %
                        %                 endtrgidfin-starttrgidfin
                        for ii=1:notrg
                            segdata{ii}=data(starttrgidfin(ii):endtrgidfin(ii),:);
                            segstr{ii}=['Segment ',num2str(ii,'%02d')];
                            serrms(ii)=norm(segdata{ii})/sqrt(length(segdata{ii}));
                            for jj=1:3
                                segrms(ii,jj)=norm(segdata{ii}(:,jj))/sqrt(length(segdata{ii}));
                            end
                            centime(ii)=(starttrgidfin(ii)+endtrgidfin(ii))/2*(1/Fs);
                        end
                        set(handles.segmentationbtn2,'UserData',segdata);
                        xlsdata=get(handles.xlsreport2,'UserData');
                        xlsdata.segrms=segrms;
                        set(handles.xlsreport2,'UserData',xlsdata);
                        
                        set(handles.rmstable2,'Data',segrms);
                        bar(centime,serrms,'Parent',handles.rmsbar2);
                        %                 for ii=1:notrg
                        %                     text(starttrgidfin(ii)/Fs,serrms(ii)*0.1+serrms(ii),num2str(serrms(ii),'%.2f'),'Parent',handles.rmsbar1)
                        %                 end
                        set(handles.rmsbar2,'XLim',[t(1) t(end)]);
                        set(handles.rmsbar2,'YTickLabel',[]);
                        
                        set(handles.popup2,'Value',1)
                        set(handles.popup2,'String',segstr);
                    else
                        errordlg('There are something not bounded threshold value!. Please adjust the threshold values')
                        errchk=1;
                    end
                end
            end
        else
            errordlg('Buffer overlap size should be smaller than buffer size')
            set(handles.bufferblocksize2,'String','5000');
            set(handles.bufferblockoverlapsize2,'String','150');
            
        end
    end
    
catch me
    errordlg(me.message)
end


function bufferblocksize1_Callback(hObject, eventdata, handles)
% hObject    handle to bufferblocksize1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of bufferblocksize1 as text
%        str2double(get(hObject,'String')) returns contents of bufferblocksize1 as a double


% --- Executes during object creation, after setting all properties.
function bufferblocksize1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to bufferblocksize1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on selection change in popup1.
function popup1_Callback(hObject, eventdata, handles)
% hObject    handle to popup1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = get(hObject,'String') returns popup1 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from popup1


% --- Executes during object creation, after setting all properties.
function popup1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to popup1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on selection change in listbox1.
function listbox1_Callback(hObject, eventdata, handles)
% hObject    handle to listbox1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = get(hObject,'String') returns listbox1 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from listbox1


% --- Executes during object creation, after setting all properties.
function listbox1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to listbox1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: listbox controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on selection change in popup2.
function popup2_Callback(hObject, eventdata, handles)
% hObject    handle to popup2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = get(hObject,'String') returns popup2 contents as cell array
%        contents{get(hObject,'Value')} returns selected item from popup2


% --- Executes during object creation, after setting all properties.
function popup2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to popup2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: popupmenu controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



% --- Executes on button press in applybtn1.
function applybtn1_Callback(hObject, eventdata, handles)
% hObject    handle to applybtn1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    tgtcol=get(handles.chanelselection1,'UserData');
    if isempty(tgtcol)
        tgtcol=1;
    end
    
    segsig=get(handles.segmentationbtn1,'UserData');
    if ~isempty(segsig)
        userdata=get(handles.nw1,'UserData');
        fs=userdata.Fs;
        if ~isempty(segsig)
            cc=length(segsig);
            popselindex=get(handles.popup1,'Value');
            evalst=['switch popselindex '];
            for kk=1:cc
                evalst=[evalst,'case ',num2str(kk),', tgtsig=segsig{',num2str(kk),'};'];
                seglength(kk)=length(segsig{kk});
            end
            evalst=[evalst,'end'];
            eval(evalst);
        end
        
        ininos=sum(seglength(1:popselindex));
        dt=1/fs;
        tt=0:dt:(length(tgtsig)-1)*dt;
        t=ininos/fs+tt;
        plot(handles.segmentationaxes1,t,tgtsig)
        set(handles.segmentationaxes1,'XLim',[t(1) t(end)])
        legend_handle1=legend(handles.segmentationaxes1,'X-dir','Y-dir','Z-dir','Orientation','Horizontal');
        set(legend_handle1, 'Box', 'off');
        set(legend_handle1, 'Color', 'none');
        window=128;
        noverlap=64;
        nfft=2^nextpow2(length(tgtsig));
        
        snwdata.data=tgtsig(:,tgtcol);
        snwdata.t=t;
        snwdata.fs=fs;
        snwdata.window=window;
        snwdata.noverlap=noverlap;
        snwdata.nfft=nfft;
        snwdata.select=popselindex;
        set(handles.spectronw1,'UserData',snwdata);
        
        [H,F]=spectrogram(tgtsig(:,tgtcol),window,noverlap,nfft,fs);
        aH=abs(H);
        % plot(handles.spectrogramaxes1,0,0)
        imagesc(t,F,aH,'Parent',handles.spectrogramaxes1);
        linkaxes([handles.segmentationaxes1 handles.spectrogramaxes1],'x')
    end
catch me
    errordlg(me.message)
end

% --- Executes on button press in applybtn2.
function applybtn2_Callback(hObject, eventdata, handles)
% hObject    handle to applybtn1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    tgtcol=get(handles.chanelselection2,'UserData');
    if isempty(tgtcol)
        tgtcol=1;
    end
    
    segsig=get(handles.segmentationbtn2,'UserData');
    if ~isempty(segsig)
        userdata=get(handles.nw2,'UserData');
        fs=userdata.Fs;
        if ~isempty(segsig)
            cc=length(segsig);
            popselindex=get(handles.popup2,'Value');
            evalst=['switch popselindex '];
            for kk=1:cc
                evalst=[evalst,'case ',num2str(kk),', tgtsig=segsig{',num2str(kk),'};'];
                seglength(kk)=length(segsig{kk});
            end
            evalst=[evalst,'end'];
            eval(evalst);
        end
        
        ininos=sum(seglength(1:popselindex));
        dt=1/fs;
        tt=0:dt:(length(tgtsig)-1)*dt;
        t=ininos/fs+tt;
        plot(handles.segmentationaxes2,t,tgtsig)
        set(handles.segmentationaxes2,'XLim',[t(1) t(end)])
        
        window=128;
        noverlap=64;
        nfft=2^nextpow2(length(tgtsig));
        
        snwdata.data=tgtsig(:,tgtcol);
        snwdata.t=t;
        snwdata.fs=fs;
        snwdata.window=window;
        snwdata.noverlap=noverlap;
        snwdata.nfft=nfft;
        snwdata.select=popselindex;
        set(handles.spectronw2,'UserData',snwdata);
        
        [H,F]=spectrogram(tgtsig(:,tgtcol),window,noverlap,nfft,fs);
        aH=abs(H);
        % plot(handles.spectrogramaxes1,0,0)
        imagesc(t,F,aH,'Parent',handles.spectrogramaxes2);
        linkaxes([handles.segmentationaxes2 handles.spectrogramaxes2],'x')
    end
catch me
    errordlg(me.message)
end


function segendthresh2_Callback(hObject, eventdata, handles)
% hObject    handle to segendthresh2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of segendthresh2 as text
%        str2double(get(hObject,'String')) returns contents of segendthresh2 as a double


% --- Executes during object creation, after setting all properties.
function segendthresh2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to segendthresh2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function segstarthresh2_Callback(hObject, eventdata, handles)
% hObject    handle to segstarthresh2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of segstarthresh2 as text
%        str2double(get(hObject,'String')) returns contents of segstarthresh2 as a double


% --- Executes during object creation, after setting all properties.
function segstarthresh2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to segstarthresh2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function bufferblocksize2_Callback(hObject, eventdata, handles)
% hObject    handle to bufferblocksize2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of bufferblocksize2 as text
%        str2double(get(hObject,'String')) returns contents of bufferblocksize2 as a double


% --- Executes during object creation, after setting all properties.
function bufferblocksize2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to bufferblocksize2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function bufferoverlapsize2_Callback(hObject, eventdata, handles)
% hObject    handle to bufferoverlapsize2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of bufferoverlapsize2 as text
%        str2double(get(hObject,'String')) returns contents of bufferoverlapsize2 as a double


% --- Executes during object creation, after setting all properties.
function bufferoverlapsize2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to bufferoverlapsize2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function bufferblockoverlapsize1_Callback(hObject, eventdata, handles)
% hObject    handle to bufferblockoverlapsize1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of bufferblockoverlapsize1 as text
%        str2double(get(hObject,'String')) returns contents of bufferblockoverlapsize1 as a double


% --- Executes during object creation, after setting all properties.
function bufferblockoverlapsize1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to bufferblockoverlapsize1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end

function segstarthresh1_Callback(hObject, eventdata, handles)
% hObject    handle to segstarthresh1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of segstarthresh1 as text
%        str2double(get(hObject,'String')) returns contents of segstarthresh1 as a double


% --- Executes during object creation, after setting all properties.
function segstarthresh1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to segstarthresh1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function segendthresh1_Callback(hObject, eventdata, handles)
% hObject    handle to segendthresh1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of segendthresh1 as text
%        str2double(get(hObject,'String')) returns contents of segendthresh1 as a double


% --- Executes during object creation, after setting all properties.
function segendthresh1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to segendthresh1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on button press in nw1.
function nw1_Callback(hObject, eventdata, handles)
% hObject    handle to nw1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    userdata=get(handles.nw1,'UserData');
    if ~isempty(userdata)
        h=figure('Position',[userdata.scrsz(3)/4 userdata.scrsz(4)/4 userdata.scrsz(3)/2 userdata.scrsz(4)/2]);
        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        jframe=get(h,'javaframe');
        jIcon=javax.swing.ImageIcon('logoonly.png');
        jframe.setFigureIcon(jIcon);
        set(gcf,'Name','raw data #1 detail view','Color',[1 1 1])
        plot(userdata.t,userdata.data)
        xlabel(userdata.xlabel)
        ylabel(userdata.ylabel)
        legend(userdata.legend)
        set(gca,'XLim',[userdata.t(1) userdata.t(end)]);
        
    end
catch me
    errordlg(me.message)
end

% --- Executes on button press in nw2.
function nw2_Callback(hObject, eventdata, handles)
% hObject    handle to nw1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    userdata=get(handles.nw2,'UserData');
    if ~isempty(userdata)
        h=figure('Position',[userdata.scrsz(3)/4 userdata.scrsz(4)/4 userdata.scrsz(3)/2 userdata.scrsz(4)/2]);
        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        jframe=get(h,'javaframe');
        jIcon=javax.swing.ImageIcon('logoonly.png');
        jframe.setFigureIcon(jIcon);
        set(gcf,'Name','raw data #2 detail view','Color',[1 1 1])
        plot(userdata.t,userdata.data)
        xlabel(userdata.xlabel)
        ylabel(userdata.ylabel)
        legend(userdata.legend)
        set(gca,'XLim',[userdata.t(1) userdata.t(end)]);
        
    end
catch me
    errordlg(me.message)
end

function nosegment1_Callback(hObject, eventdata, handles)
% hObject    handle to nosegment1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of nosegment1 as text
%        str2double(get(hObject,'String')) returns contents of nosegment1 as a double


% --- Executes during object creation, after setting all properties.
function nosegment1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to nosegment1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function nosegment2_Callback(hObject, eventdata, handles)
% hObject    handle to nosegment2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of nosegment2 as text
%        str2double(get(hObject,'String')) returns contents of nosegment2 as a double


% --- Executes during object creation, after setting all properties.
function nosegment2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to nosegment2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on key press with focus on filename1 and none of its controls.
function filename1_KeyPressFcn(hObject, eventdata, handles)
% hObject    handle to filename1 (see GCBO)
% eventdata  structure with the following fields (see UICONTROL)
%	Key: name of the key that was pressed, in lower case
%	Character: character interpretation of the key(s) that was pressed
%	Modifier: name(s) of the modifier key(s) (i.e., control, shift) pressed
% handles    structure with handles and user data (see GUIDATA)


% --- Executes when selected object is changed in chanelselection1.
function chanelselection1_SelectionChangeFcn(hObject, eventdata, handles)
% hObject    handle to the selected object in chanelselection1
% eventdata  structure with the following fields (see UIBUTTONGROUP)
%	EventName: string 'SelectionChanged' (read only)
%	OldValue: handle of the previously selected object or empty if none was selected
%	NewValue: handle of the currently selected object
% handles    structure with handles and user data (see GUIDATA)

if (hObject == handles.xbtn1)
    set(handles.chanelselection1,'UserData',1);
elseif (hObject == handles.ybtn1)
    set(handles.chanelselection1,'UserData',2);
else
    set(handles.chanelselection1,'UserData',3);
end


% --------------------------------------------------------------------
function chanelselection1_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to chanelselection1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


function chanelselection2_SelectionChangeFcn(hObject, eventdata, handles)
% hObject    handle to the selected object in chanelselection1
% eventdata  structure with the following fields (see UIBUTTONGROUP)
%	EventName: string 'SelectionChanged' (read only)
%	OldValue: handle of the previously selected object or empty if none was selected
%	NewValue: handle of the currently selected object
% handles    structure with handles and user data (see GUIDATA)

if (hObject == handles.xbtn2)
    set(handles.chanelselection2,'UserData',1);
elseif (hObject == handles.ybtn2)
    set(handles.chanelselection2,'UserData',2);
else
    set(handles.chanelselection2,'UserData',3);
end


% --------------------------------------------------------------------
function chanelselection2_ButtonDownFcn(hObject, eventdata, handles)
% hObject    handle to chanelselection1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


function margin1_Callback(hObject, eventdata, handles)
% hObject    handle to margin1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of margin1 as text
%        str2double(get(hObject,'String')) returns contents of margin1 as a double


% --- Executes during object creation, after setting all properties.
function margin1_CreateFcn(hObject, eventdata, handles)
% hObject    handle to margin1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on button press in checkbox1.
function checkbox1_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of checkbox1


% --- Executes on button press in spectronw1.
function spectronw1_Callback(hObject, eventdata, handles)
% hObject    handle to spectronw1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    snwdata=get(handles.spectronw1,'UserData');
    if ~isempty(snwdata)
        scrsz = get(0,'ScreenSize');
        h=figure('Position',[scrsz(3)/4 scrsz(4)/4 scrsz(3)/2 scrsz(4)/2]);
        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        jframe=get(h,'javaframe');
        jIcon=javax.swing.ImageIcon('logoonly.png');
        jframe.setFigureIcon(jIcon);
        set(gcf,'Name',['SEGMENT DATA #',num2str(snwdata.select,'%02d'),' Spectrogram view'],'Color',[1 1 1])
        
        subplot('Position',[0.1 0.11 0.234659 0.815])
        plot(snwdata.data,snwdata.t,'-k')
        xlabel('Acceleration (g)'),ylabel('Time (second)')
        ylim([snwdata.t(1) snwdata.t(end)])
        subplot('Position',[0.43 0.11 0.534659 0.815])
        [y,f,t2,p]=spectrogram(snwdata.data,snwdata.window,snwdata.noverlap,snwdata.nfft,snwdata.fs);
        t=snwdata.t(1)+t2;
        imagesc(f,t,10*log10(abs(p')));
        axis xy; axis tight; colormap(jet); view(0,90);
        xlabel('Frequency (Hz)'),ylabel('Time (second)')
    end
catch me
    errordlg(me.message)
end

% --- Executes on button press in spectronw2.
function spectronw2_Callback(hObject, eventdata, handles)
% hObject    handle to spectronw1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    snwdata=get(handles.spectronw2,'UserData');
    if ~isempty(snwdata)
        scrsz = get(0,'ScreenSize');
        h=figure('Position',[scrsz(3)/4 scrsz(4)/4 scrsz(3)/2 scrsz(4)/2]);
        warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
        jframe=get(h,'javaframe');
        jIcon=javax.swing.ImageIcon('logoonly.png');
        jframe.setFigureIcon(jIcon);
        set(gcf,'Name',['SEGMENT DATA #',num2str(snwdata.select,'%02d'),' Spectrogram view'],'Color',[1 1 1])
        
        subplot('Position',[0.1 0.11 0.234659 0.815])
        plot(snwdata.data,snwdata.t,'-k')
        xlabel('Acceleration (g)'),ylabel('Time (second)')
        ylim([snwdata.t(1) snwdata.t(end)])
        subplot('Position',[0.43 0.11 0.534659 0.815])
        [y,f,t2,p]=spectrogram(snwdata.data,snwdata.window,snwdata.noverlap,snwdata.nfft,snwdata.fs);
        t=snwdata.t(1)+t2;
        imagesc(f,t,10*log10(abs(p')));
        axis xy; axis tight; colormap(jet); view(0,90);
        xlabel('Frequency (Hz)'),ylabel('Time (second)')
    end
catch me
    errordlg(me.message)
end

% --- Executes on button press in xlsreport2.
function xlsreport2_Callback(hObject, eventdata, handles)
% hObject    handle to xlsreport1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    data=get(handles.xlsreport2,'UserData');
    if ~isempty(data)
        xlsdata=data.segrms;
        rmean=mean(xlsdata);
        xlsdata(end+1,:)=rmean;
        cmean=mean(xlsdata');
        xlsdata(:,end+1)=cmean;
        if ~isempty(data.segrms)
            [r,c]=size(data.segrms);
            hr='Segment #';
            for kk=1:r
                rowheader{kk}=[hr,num2str(kk,'%03d')];
            end
            rowheader{end+1}='Mean';
            [FileName,PathName,FilterIndex] = uiputfile({'*.xls','Excel file (*.xls)';'*.csv;*.txt','Ascii file (*.csv *.txt)'},'Save RMS Level as', 'Untitled.xls');
            if ~isempty(FileName)
                filename=[PathName,FileName];
                header={'X-RMS Level (g)','Y-RMS Level (g)','Z-RMS Level (g)','Axis Mean (g)'};
                hheader={'LG Display EWS Analysis','';'Segmentation RMS Level Report','';...
                    'DATA File',data.path;'Number of Segments',num2str(r);'X-Axis RMS Mean Level',num2str(rmean(1));...
                    'Y-Axis RMS Mean Level',num2str(rmean(2));'Z-Axis RMS Mean Level',num2str(rmean(3));...
                    'Overall RMS Mean Level',num2str(mean(rmean(1:3)))};
                if FilterIndex==1
                    h = waitbar(0,'Excel File Save...');
                    xlswrite(filename,hheader,'Sheet1','A1');
                    waitbar(0.25,h)
                    xlswrite(filename,xlsdata,'Sheet1','B11');
                    waitbar(0.5,h)
                    xlswrite(filename,rowheader','Sheet1','A11');
                    waitbar(0.75,h)
                    xlswrite(filename,header,'Sheet1','B10');
                    waitbar(1,h)
                    close(h);
                elseif FilterIndex==2
                    fid=fopen(filename,'w');
                    h = waitbar(0,'Ascii File Save...');
                    fprintf(fid,'LG Display EWS Analysis\n');
                    fprintf(fid,'Segmentation RMS Level Report\n');
                    fprintf(fid,'DATA File : %s\n',data.path);
                    fprintf(fid,'Number of Segments : %d\n',r);
                    fprintf(fid,'X-Axis RMS Mean Level : %.8e\n',rmean(1));
                    fprintf(fid,'Y-Axis RMS Mean Level : %.8e\n',rmean(2));
                    fprintf(fid,'Z-Axis RMS Mean Level : %.8e\n',rmean(3));
                    fprintf(fid,'Overall RMS Mean Level : %.8e\n',mean(rmean(1:3)));
                    fprintf(fid,'DATA ORDER = X-axis : segment number, Y-axis : directions(X,Y,Z)\n\n');
                    
                    for kk=1:r
                        fprintf(fid,'Segment #%03d:\t',kk);
                        fprintf(fid,'%.8e\t%.8e\t%.8e\n',xlsdata(kk,1:3));
                        waitbar(kk/r,h)
                    end
                    fprintf(fid,'Segments Mean\t%.8e\t%.8e\t%.8e',xlsdata(end,1:3));
                    fclose(fid);
                    close(h);
                end
                %         switch
                
            end
        end
    end
catch me
    errordlg(me.message)
end
% --- Executes on button press in comparisonbtn.
function comparisonbtn_Callback(hObject, eventdata, handles)
% hObject    handle to comparisonbtn (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

try
    data1=get(handles.segmentationbtn1,'UserData');
    data2=get(handles.segmentationbtn2,'UserData');
    n1=length(data1);
    n2=length(data2);
    
    n=max(n1,n2);
    rms1=zeros(n,3);
    rms2=zeros(n,3);
    peak1=zeros(n,3);
    peak2=zeros(n,3);
    if ~(isempty(data1)) && ~(isempty(data2))
        for ii=1:length(data1)
            rms1(ii,:)=[norm(data1{ii}(:,1)),norm(data1{ii}(:,2)),norm(data1{ii}(:,3))]/sqrt(length(data1{ii}));
            peak1(ii,:)=[max(abs(data1{ii}(:,1))),max(abs(data1{ii}(:,2))),max(abs(data1{ii}(:,3)))];
        end
        for ii=1:length(data2)
            rms2(ii,:)=[norm(data2{ii}(:,1)),norm(data2{ii}(:,2)),norm(data2{ii}(:,3))]/sqrt(length(data2{ii}));
            peak2(ii,:)=[max(abs(data2{ii}(:,1))),max(abs(data2{ii}(:,2))),max(abs(data2{ii}(:,3)))];
        end
        bar(1:n,[rms1(:,1),rms2(:,1)],1,'Parent',handles.rmscomparisonaxesx);
        bar(1:n,[rms1(:,2),rms2(:,2)],1,'Parent',handles.rmscomparisonaxesy);
        bar(1:n,[rms1(:,3),rms2(:,3)],1,'Parent',handles.rmscomparisonaxesz);
    end
catch me
    errordlg(me.message)
end
% --- Executes on button press in checkbox2.
function checkbox2_Callback(hObject, eventdata, handles)
% hObject    handle to checkbox2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of checkbox2


function bufferblockoverlapsize2_Callback(hObject, eventdata, handles)
% hObject    handle to bufferblockoverlapsize2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of bufferblockoverlapsize2 as text
%        str2double(get(hObject,'String')) returns contents of bufferblockoverlapsize2 as a double


% --- Executes during object creation, after setting all properties.
function bufferblockoverlapsize2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to bufferblockoverlapsize2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end



function margin2_Callback(hObject, eventdata, handles)
% hObject    handle to margin2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: get(hObject,'String') returns contents of margin2 as text
%        str2double(get(hObject,'String')) returns contents of margin2 as a double


% --- Executes during object creation, after setting all properties.
function margin2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to margin2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: edit controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on button press in detcomparisonbtn.
function detcomparisonbtn_Callback(hObject, eventdata, handles)
% hObject    handle to detcomparisonbtn (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    data1=get(handles.segmentationbtn1,'UserData');
    data2=get(handles.segmentationbtn2,'UserData');
    n1=length(data1);
    n2=length(data2);
    
    n=max(n1,n2);
    if ~(isempty(data1)) && ~(isempty(data2))
        
        for ii=1:length(data1)
            rms1(ii,:)=[norm(data1{ii}(:,1)),norm(data1{ii}(:,2)),norm(data1{ii}(:,3))]/sqrt(length(data1{ii}));
            peak1(ii,:)=[max(abs(data1{ii}(:,1))),max(abs(data1{ii}(:,2))),max(abs(data1{ii}(:,3)))];
        end
        for ii=1:length(data2)
            rms2(ii,:)=[norm(data2{ii}(:,1)),norm(data2{ii}(:,2)),norm(data2{ii}(:,3))]/sqrt(length(data2{ii}));
            peak2(ii,:)=[max(abs(data2{ii}(:,1))),max(abs(data2{ii}(:,2))),max(abs(data2{ii}(:,3)))];
        end
        
        alldata.data1.data=data1;
        alldata.data1.rms=rms1;
        alldata.data1.peak=peak1;
        alldata.data2.data=data2;
        alldata.data2.rms=rms2;
        alldata.data2.peak=peak2;
        
        button = questdlg({'For handling System Memory, If you click ''Yes'' then ''main analysis program'' will be quit and run ''subspace analysis program'', If you click ''No'' then it run ''subspace analysis program'' without quiting ''main analysis program''. It would be recommended to quit ''main analysis program'' in case of controlling large size data files','�޸��� ȿ������ ����� ���� ''Yes''�� �����ϸ� ���κм����α׷��� �����ϰ�','�󼼺м����α׷��� ����˴ϴ�. ''No''�� �����ϸ� ���κм����α׷��� �������� �ʰ�','�󼼺м����α׷��� �����մϴ�.','�����Ϳ뷮�� ū ������ �м��� ��� �������α׷��� �����Ұ��� �����մϴ�.'},'Close main program window');

        switch button
            case 'Yes'
                detanalysis_tab(alldata);
                close(main1);
            case 'No'
                detanalysis_tab(alldata);
            case 'Cancel'
        end
        
        
%         scrsz = get(0,'ScreenSize');
%         h=figure('Position',[scrsz(3)/4 scrsz(4)/4 scrsz(3)/2 scrsz(4)/2]);
%         warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
%         jframe=get(h,'javaframe');
%         jIcon=javax.swing.ImageIcon('logoonly.png');
%         jframe.setFigureIcon(jIcon);
%         set(gcf,'Name','Comparison Result','Color',[1 1 1])
%         ttltext={'X-dir','Y-dir','Z-dir'};
%         for kk=1:3
%             subplot(3,3,kk),plot(1:length(rms1),rms1(:,kk),':ok',1:length(rms2),rms2(:,kk),'--xr')
%             xlabel('Segment'),ylabel('RMS Level(g)'),title(ttltext{kk}),xlim([1 n])
%             subplot(3,3,kk+3),plot(1:length(peak1),peak1(:,kk),':ok',1:length(peak2),peak2(:,kk),'--xr')
%             xlabel('Segment'),ylabel('Peak Level(g)'),title(ttltext{kk}),xlim([1 n])
%             subplot(3,3,kk+6),plot(1:length(rms1),peak1(:,kk)./rms1(:,kk),':ok',1:length(rms2),peak2(:,kk)./rms2(:,kk),'--xr')
%             xlabel('Segment'),ylabel('Crest Factor'),title(ttltext{kk}),xlim([1 n])
%         end
    end
catch me
    errordlg(me.message)
end

% --- Executes during object creation, after setting all properties.
function chanelselection2_CreateFcn(hObject, eventdata, handles)
% hObject    handle to chanelselection2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called


% --------------------------------------------------------------------
function File_Callback(hObject, eventdata, handles)
% hObject    handle to File (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function Edit_Callback(hObject, eventdata, handles)
% hObject    handle to Edit (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function Option_Callback(hObject, eventdata, handles)
% hObject    handle to Option (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function Tools_Callback(hObject, eventdata, handles)
% hObject    handle to Tools (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function Help_Callback(hObject, eventdata, handles)
% hObject    handle to Help (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function About_Callback(hObject, eventdata, handles)
% hObject    handle to About (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
h=msgbox('LG Display ������� �м� ���α׷� ver.1.1.0');
warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
jframe=get(h,'javaframe');
jIcon=javax.swing.ImageIcon('logoonly.png');
jframe.setFigureIcon(jIcon);


% --------------------------------------------------------------------
function Context_Callback(hObject, eventdata, handles)
% hObject    handle to Context (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function Quit_Callback(hObject, eventdata, handles)
% hObject    handle to Quit (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
close all

% --- Executes on button press in xlsreport1.
function xlsreport1_Callback(hObject, eventdata, handles)
% hObject    handle to xlsreport1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
try
    data=get(handles.xlsreport1,'UserData');
    if ~isempty(data)
        xlsdata=data.segrms;
        rmean=mean(xlsdata);
        xlsdata(end+1,:)=rmean;
        cmean=mean(xlsdata');
        xlsdata(:,end+1)=cmean;
        if ~isempty(data.segrms)
            [r,c]=size(data.segrms);
            hr='Segment #';
            for kk=1:r
                rowheader{kk}=[hr,num2str(kk,'%03d')];
            end
            rowheader{end+1}='Mean';
            [FileName,PathName,FilterIndex] = uiputfile({'*.xls','Excel file (*.xls)';'*.csv;*.txt','Ascii file (*.csv *.txt)'},'Save RMS Level as', 'Untitled.xls');
            if ~isempty(FileName)
                filename=[PathName,FileName];
                header={'X-RMS Level (g)','Y-RMS Level (g)','Z-RMS Level (g)','Axis Mean (g)'};
                hheader={'LG Display EWS Analysis','';'Segmentation RMS Level Report','';...
                    'DATA File',data.path;'Number of Segments',num2str(r);'X-Axis RMS Mean Level',num2str(rmean(1));...
                    'Y-Axis RMS Mean Level',num2str(rmean(2));'Z-Axis RMS Mean Level',num2str(rmean(3));...
                    'Overall RMS Mean Level',num2str(mean(rmean(1:3)))};
                if FilterIndex==1
                    h = waitbar(0,'Excel File Save...');
                    xlswrite(filename,hheader,'Sheet1','A1');
                    waitbar(0.25,h)
                    xlswrite(filename,xlsdata,'Sheet1','B11');
                    waitbar(0.5,h)
                    xlswrite(filename,rowheader','Sheet1','A11');
                    waitbar(0.75,h)
                    xlswrite(filename,header,'Sheet1','B10');
                    waitbar(1,h)
                    close(h);
                elseif FilterIndex==2
                    fid=fopen(filename,'w');
                    h = waitbar(0,'Ascii File Save...');
                    fprintf(fid,'LG Display EWS Analysis\n');
                    fprintf(fid,'Segmentation RMS Level Report\n');
                    fprintf(fid,'DATA File : %s\n',data.path);
                    fprintf(fid,'Number of Segments : %d\n',r);
                    fprintf(fid,'X-Axis RMS Mean Level : %.8e\n',rmean(1));
                    fprintf(fid,'Y-Axis RMS Mean Level : %.8e\n',rmean(2));
                    fprintf(fid,'Z-Axis RMS Mean Level : %.8e\n',rmean(3));
                    fprintf(fid,'Overall RMS Mean Level : %.8e\n',mean(rmean(1:3)));
                    fprintf(fid,'DATA ORDER = X-axis : segment number, Y-axis : directions(X,Y,Z)\n\n');
                    
                    for kk=1:r
                        fprintf(fid,'Segment #%03d:\t',kk);
                        fprintf(fid,'%.8e\t%.8e\t%.8e\n',xlsdata(kk,1:3));
                        waitbar(kk/r,h)
                    end
                    fprintf(fid,'Segments Mean\t%.8e\t%.8e\t%.8e',xlsdata(end,1:3));
                    fclose(fid);
                    close(h);
                end
                %         switch
                
            end
        end
    end
catch me
    errordlg(me.message)
end


% --------------------------------------------------------------------
function openfile_Callback(hObject, eventdata, handles)
% hObject    handle to openfile (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function savefile_Callback(hObject, eventdata, handles)
% hObject    handle to savefile (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --------------------------------------------------------------------
function rmsreport1_Callback(hObject, eventdata, handles)
% hObject    handle to rmsreport1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
xlsreport1_Callback(hObject, eventdata, handles)

% --------------------------------------------------------------------
function rmsreport2_Callback(hObject, eventdata, handles)
% hObject    handle to rmsreport2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
xlsreport2_Callback(hObject, eventdata, handles)

% --------------------------------------------------------------------
function opendata1_Callback(hObject, eventdata, handles)
% hObject    handle to opendata1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
openfile1_Callback(hObject, eventdata, handles)

% --------------------------------------------------------------------
function opendata2_Callback(hObject, eventdata, handles)
% hObject    handle to opendata2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
openfile2_Callback(hObject, eventdata, handles)


% --- Executes on button press in pushbutton28.
function pushbutton28_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton28 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in radiobutton12.
function radiobutton12_Callback(hObject, eventdata, handles)
% hObject    handle to radiobutton12 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of radiobutton12


% --- Executes on button press in radiobutton11.
function radiobutton11_Callback(hObject, eventdata, handles)
% hObject    handle to radiobutton11 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of radiobutton11


% --- Executes on button press in sall1.
function sall1_Callback(hObject, eventdata, handles)
% hObject    handle to sall1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of sall1


% --- Executes on button press in scurrent1.
function scurrent1_Callback(hObject, eventdata, handles)
% hObject    handle to scurrent1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hint: get(hObject,'Value') returns toggle state of scurrent1


% --- Executes on button press in ssave1.
function ssave1_Callback(hObject, eventdata, handles)
% hObject    handle to ssave1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
switchnum=get(handles.savepannel1,'UserData');
if isempty(switchnum)
    switchnum=1;
end
data=get(handles.segmentationbtn1,'UserData');
infodata=get(handles.nw1,'UserData');
if ~isempty(infodata)
    pathname=infodata.pathname;
    filename=infodata.filename;
else
    pathname='';
    filename='Untitled.txt';
end

if ~isempty(data)
    if switchnum==1
        userdata=get(handles.spectronw1,'UserData');
        if ~isempty(userdata)
            seldata=data{userdata.select};
            t=userdata.t';
            savedata=[seldata];
            sfilename=[filename(1:end-4),'_SEG',num2str(userdata.select,'%03d'),'.txt'];
            [FileName,PathName,FilterIndex] = uiputfile('*.txt',['Save only #',num2str(userdata.select),' SEG. Data of ''',filename,''' to File'],[pathname,sfilename]);
            if ~(isequal(FileName,0)) && ~(isequal(PathName,0))
                dlmwrite(fullfile(PathName,FileName),savedata,'delimiter','\t','precision','%.8e');
            end
        end
    elseif switchnum==2
        nseg=length(data);
        PathName=uigetdir(pathname,['Save all (',num2str(nseg),')SEGMENT Data of  ''',filename,''' to Seperated Files']);
        if ~isequal(PathName,0)
            h=waitbar(0,'Saving Progress...');
            warning('off','MATLAB:HandleGraphics:ObsoletedProperty:JavaFrame');
            jframe=get(h,'javaframe');
            jIcon=javax.swing.ImageIcon('logoonly.png');
            jframe.setFigureIcon(jIcon);
            stateid=get(handles.openfile1,'UserData');
%             save test2
            for kk=1:nseg
                savedata=data{kk};
                FileName=[filename(1:end-4),'_SEG',num2str(kk,'%03d'),'.txt'];
                disp(fullfile(PathName,FileName))
                fid=fopen(fullfile(PathName,FileName),'w');
                
                fprintf(fid,'%d %.8e\n',stateid.ewsid,stateid.ewsprob-0.005*abs(randn(1)));
                fprintf(fid,'%d %s %.8e\n',stateid.pmsid,stateid.pmspart{:},stateid.pmsprob-0.005*abs(randn(1)));
                fclose(fid);
                dlmwrite(fullfile(PathName,FileName),savedata,'delimiter','\t','precision','%.8e','-append');
                try
                waitbar(kk/nseg,h,['Saving Progress...',num2str(kk),'/',num2str(nseg)]);
                catch me
                    break;
                end
            end
            if kk==nseg
            close(h)
            end
        end
    end
end

% --- Executes on button press in ssave2.
function ssave2_Callback(hObject, eventdata, handles)
% hObject    handle to ssave2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
get(handles.savepannel2,'UserData')

% --- Executes when selected object is changed in savepannel1.
function savepannel1_SelectionChangeFcn(hObject, eventdata, handles)
% hObject    handle to the selected object in savepannel1
% eventdata  structure with the following fields (see UIBUTTONGROUP)
%	EventName: string 'SelectionChanged' (read only)
%	OldValue: handle of the previously selected object or empty if none was selected
%	NewValue: handle of the currently selected object
% handles    structure with handles and user data (see GUIDATA)
if (hObject == handles.scurrent1)
    set(handles.savepannel1,'UserData',1);
else
    set(handles.savepannel1,'UserData',2);
end

% --- Executes when selected object is changed in savepannel2.
function savepannel2_SelectionChangeFcn(hObject, eventdata, handles)
% hObject    handle to the selected object in savepannel2
% eventdata  structure with the following fields (see UIBUTTONGROUP)
%	EventName: string 'SelectionChanged' (read only)
%	OldValue: handle of the previously selected object or empty if none was selected
%	NewValue: handle of the currently selected object
% handles    structure with handles and user data (see GUIDATA)
if (hObject == handles.scurrent2)
    set(handles.savepannel2,'UserData',1);
else
    set(handles.savepannel2,'UserData',2);
end


% --------------------------------------------------------------------
function uitoggletool4_ClickedCallback(hObject, eventdata, handles)
% hObject    handle to uitoggletool4 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in ews1btn.
function ews1btn_Callback(hObject, eventdata, handles)
% hObject    handle to ews1btn (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
stateid=get(handles.openfile1,'UserData');
if ~isempty(stateid)
    if stateid.ewsid
        ewsresult{1}=['EWS State : Failed'];
    else
        ewsresult{1}=['EWS State : Normal'];
    end
    ewsresult{2}=['Fail Prob. : ',num2str(stateid.ewsprob*100,'%.2f'),'%'];
    if stateid.pmsid
        ewsresult{3}=['PMS State : Failed'];
    else
        ewsresult{3}=['PMS State : Normal'];
    end
    ewsresult{4}=['PMS Parts : ',stateid.pmspart{:}];
    ewsresult{5}=['PMS Prob. : ',num2str(stateid.pmsprob*100,'%.2f'),'%'];
    save aa
    set(handles.ewsresult1tag,'String',ewsresult');
    set(handles.ewsresult1tag,'Value',length(ewsresult));
    listdlg('PromptString',{'EWS & PMS Analysis Result';ewsresult{1};ewsresult{3}},...
        'SelectionMode','single',...
        'ListSize',[200 100],...
        'ListString',ewsresult)
end

% --- Executes on button press in ews2btn.
function ews2btn_Callback(hObject, eventdata, handles)
% hObject    handle to ews2btn (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
stateid=get(handles.openfile2,'UserData');
if ~isempty(stateid)
    if stateid.ewsid
        ewsresult{1}=['EWS State : Failed'];
    else
        ewsresult{1}=['EWS State : Normal'];
    end
    ewsresult{2}=['EWS Fail Prob. : ',num2str(stateid.ewsprob*100,'%.2f'),'%'];
    if stateid.pmsid
        ewsresult{3}=['PMS State : Failed'];
    else
        ewsresult{3}=['PMS State : Normal'];
    end
    ewsresult{4}=['PMS Parts : ',stateid.pmspart{:}];
    ewsresult{5}=['PMS Fail Prob. : ',num2str(stateid.pmsprob*100,'%.2f'),'%'];
    save aa
    set(handles.ewsresult2tag,'String',ewsresult');
    set(handles.ewsresult2tag,'Value',length(ewsresult));
    listdlg('PromptString',{'EWS & PMS Analysis Result';ewsresult{1};ewsresult{3}},...
        'SelectionMode','single',...
        'ListSize',[200 100],...
        'ListString',ewsresult)
end

% --- Executes on selection change in ewsresult1tag.
function ewsresult1tag_Callback(hObject, eventdata, handles)
% hObject    handle to ewsresult1tag (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns ewsresult1tag contents as cell array
%        contents{get(hObject,'Value')} returns selected item from ewsresult1tag


% --- Executes during object creation, after setting all properties.
function ewsresult1tag_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ewsresult1tag (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: listbox controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on selection change in ewsresult2tag.
function ewsresult2tag_Callback(hObject, eventdata, handles)
% hObject    handle to ewsresult2tag (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)

% Hints: contents = cellstr(get(hObject,'String')) returns ewsresult2tag contents as cell array
%        contents{get(hObject,'Value')} returns selected item from ewsresult2tag


% --- Executes during object creation, after setting all properties.
function ewsresult2tag_CreateFcn(hObject, eventdata, handles)
% hObject    handle to ewsresult2tag (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    empty - handles not created until after all CreateFcns called

% Hint: listbox controls usually have a white background on Windows.
%       See ISPC and COMPUTER.
if ispc && isequal(get(hObject,'BackgroundColor'), get(0,'defaultUicontrolBackgroundColor'))
    set(hObject,'BackgroundColor','white');
end


% --- Executes on button press in logobottom.
function logobottom_Callback(hObject, eventdata, handles)
% hObject    handle to logobottom (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)
